<!DOCTYPE html>
<!-- Page generated 2022-07-02 18:47:56 +0000-->
<html lang="en"><head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="robots" content="noindex"/><title>docker buildx build | Docker Documentation</title>
  <meta name="description" content="docker buildx build: The `buildx build` command starts a build using BuildKit. This command is similar to the UI of `docker build` command and takes the same flags and arguments...." />
  <meta name="keywords" content="docker, docker open source, docker platform, distributed applications, microservices, containers, docker containers, docker software, docker virtualization">
  <link rel="canonical" href="https://localhost:4000/engine/reference/commandline/buildx_build/" />

  <!-- favicon -->
  <link rel="icon" type="image/x-icon" href="/favicons/docs@2x.ico" sizes="129x128">
  <link rel="apple-touch-icon" type="image/x-icon" href="/favicons/docs@2x.ico" sizes="129x128">
  <meta name="msapplication-TileImage" content="/favicons/docs@2x.ico">
  <meta property="og:image" content="/favicons/docs@2x.ico"/>
  <meta name="theme-color" content="#2496ed" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- hide elements that are only shown without JavaScript enabled -->
  <script>document.documentElement.classList.add('js')</script>
  <style>html.js .no-js { display: none !important; }</style><script defer src="/js/theme-switcher.js"></script>
  <script defer src="/js/anchorlinks.js"></script>
  <script defer src="/js/jquery.js"></script>
  <script defer src="/js/bootstrap.min.js"></script>
  <script defer src="/js/docs.js"></script><link rel="preload" as="font" href="https://fonts.gstatic.com/s/opensans/v18/mem8YaGs126MiZpBA-UFVZ0bf8pkAg.woff2" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" as="font" href="/fonts/geomanist/hinted-Geomanist-Book.woff2"    type="font/woff2" crossorigin="anonymous">
  <link rel="preload" as="font" href="/fonts/geomanist/hinted-Geomanist-Regular.woff2" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" as="font" href="/fonts/glyphicons-halflings-regular.woff2"       type="font/woff2" crossorigin="anonymous">
  <link rel="preload" as="font" href="/fonts/fontawesome-webfont.woff2?v=4.7.0"        type="font/woff2" crossorigin="anonymous">

  <link rel="stylesheet" href="/css/font-awesome.min.css">
  <link rel="stylesheet" href="/css/bootstrap.min.css">
  <link rel="stylesheet" href="/css/style.css" id="pagestyle">

  <!-- SEO stuff -->
  <meta name="twitter:title" itemprop="title name" content="docker buildx build"/>
  <meta name="twitter:description" property="og:description" itemprop="description" content="docker buildx build: The `buildx build` command starts a build using BuildKit. This command is similar to the UI of `docker build` command and takes the same flags and arguments...." />
  <meta name="twitter:card" content="summary_large_image"/>
  <meta name="twitter:domain" content="docs.docker.com"/>
  <meta name="twitter:site" content="@docker_docs"/>
  <meta name="twitter:url" content="https://twitter.com/docker_docs"/>
  <meta name="twitter:image:src" content="https://docs.docker.com/images/docs@2x.png"/>
  <meta name="twitter:image:alt" content="Docker Documentation"/>
  <meta property="og:title" content="docker buildx build" />
  <meta property="og:description" content="docker buildx build: The `buildx build` command starts a build using BuildKit. This command is similar to the UI of `docker build` command and takes the same flags and arguments...." />
  <meta property="og:type" content="website"/>
  <meta property="og:updated_time" itemprop="dateUpdated" content="2022-07-02T18:47:56+00:00"/>
  <meta property="og:image" itemprop="image primaryImageOfPage" content="https://docs.docker.com/images/docs@2x.png"/>
  <meta property="og:locale" content="en_US" />
  <meta property="og:url" content="https://docs.docker.com/engine/reference/commandline/buildx_build/" />
  <meta property="og:site_name" content="Docker Documentation" />
  <meta property="article:published_time" itemprop="datePublished" content="2022-07-02T18:47:56+00:00"/>
  <script type="application/ld+json">{"@context":"https://schema.org","@type":"WebPage","headline":"docker buildx build","description":"docker buildx build: The `buildx build` command starts a build using BuildKit. This command is similar to the UI of `docker build` command and takes the same flags and arguments....","url":"https://docs.docker.com/engine/reference/commandline/buildx_build/"}</script>
  <!-- END SEO STUFF -->
</head>
<body class="colums">
    <header>
        <nav class="nav-secondary navbar navbar-fixed-top">
    <div class="container-fluid">
        <div class="navbar-header">
            <a href="/">
                <img class="logo" src="/images/docker-docs-logo.svg" alt="Docker Docs" title="Docker Docs" width="160" height="28" />
            </a>
        </div>
        <div class="navbar-collapse" aria-expanded="false" style="height: 1px;">
            <div class="logo-mobile">
    <a href="/">
        <img src="/images/docker-icon.svg" alt="Docker Docs" title="Docker Docs" width="30" height="30" />
    </a>
</div>
<div class="search-form" id="search-div">
    <form class="search-form form-inline" id="searchForm" action="/search/" method="get">
        <label for="st-search-input" class="sr-only">Search</label>
        <input class="search-field form-control ds-input" id="st-search-input" name="q" placeholder="Search the docs" type="search" autocomplete="off" spellcheck="false" dir="auto" style="position: relative; vertical-align: top;">
        <div id="autocompleteResults"></div>
        <!-- <button type="submit" class="search-submit btn btn-default">Search</button> -->
    </form>
</div>
<div class="sidebar-toggle">
    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
    </button>
</div>
<div class="nav-container hidden-sm hidden-xs">
    <div>
        <ul class="nav navbar-nav"><li><a href="/" id="home">Home</a></li><li><a href="/get-started/overview/" id="guides">Guides</a></li><li><a href="/desktop/" id="manuals">Manuals</a></li><li><a href="/reference/" id="reference">Reference</a></li><li><a href="/samples/" id="samples">Samples</a></li></ul>
    </div>
    <div class="ctrl-right">
        <a href="javascript:void(0)" id="menu-toggle" aria-label="Current page's menu toggle"><i class="fa fa-indent" aria-hidden="true"></i></a>
    </div>
</div>
<div class="row hidden-sm hidden-xs">
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li><a href="/" title="Docker docs homepage"><i class="fa fa-home"></i></a></li>
            <li><a href="/reference/">Reference</a></li><li><a>Command-line reference</a></li><li><a href="/engine/reference/run/">Docker CLI (docker)</a></li><li><a href="/engine/reference/commandline/buildx/">docker buildx</a></li><li><a href="/engine/reference/commandline/buildx_build/">docker buildx build</a></li></ol>
    </nav>
</div></div>
    </div>
</nav>

    </header>
    <div class="wrapper right-open">
        <div class="container-fluid">
            <div class="row">
                <div class="col-body">
                    <main class="col-content content">
                        <section class="section"><h1>docker buildx build</h1><!--
This page is automatically generated from Docker's source code. If you want to
suggest a change to the text that appears here, open a ticket or pull request
in the source repository on GitHub:

https://github.com/docker/buildx
-->
<!-- Make sure atom is using hard tabs -->

<p><br /></p>

<p>Start a build</p>

<h2 id="usage">Usage</h2>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>docker buildx build <span class="o">[</span>OPTIONS] PATH | URL | -
</code></pre></div></div>

<p>Refer to the <a href="#options">options section</a> for an overview of available <a href="#options"><code class="language-plaintext highlighter-rouge">OPTIONS</code></a> for this command.</p>

<h2 id="description">Description</h2>

<p name="extended-description">The <code class="language-plaintext highlighter-rouge">buildx build</code> command starts a build using BuildKit. This command is similar
to the UI of <code class="language-plaintext highlighter-rouge">docker build</code> command and takes the same flags and arguments.</p>

<p>For documentation on most of these flags, refer to the <a href="/engine/reference/commandline/build/"><code class="language-plaintext highlighter-rouge">docker build</code>
documentation</a>. In
here we’ll document a subset of the new flags.</p>

<p>For example uses of this command, refer to the <a href="#examples">examples section</a> below.</p>

<h2 id="options">Options</h2>

<table>
<thead>
  <tr>
    <td>Name, shorthand</td>
    <td>Default</td>
    <td>Description</td>
  </tr>
</thead>
<tbody>

  
  
  
  
  
  
  <tr>
    <td><a href="/engine/reference/commandline/build/#add-entries-to-container-hosts-file---add-host"><code class="language-plaintext highlighter-rouge">--add-host</code></a></td>
    <td></td>
    <td>Add a custom host-to-IP mapping (format: <code class="language-plaintext highlighter-rouge">host:ip</code>)</td>
  </tr>

  
  
  
  
  
  
  <tr>
    <td><a href="#allow"><code class="language-plaintext highlighter-rouge">--allow</code></a></td>
    <td></td>
    <td>Allow extra privileged entitlement (e.g., <code class="language-plaintext highlighter-rouge">network.host</code>, <code class="language-plaintext highlighter-rouge">security.insecure</code>)</td>
  </tr>

  
  
  
  
  
  
  <tr>
    <td><a href="#build-arg"><code class="language-plaintext highlighter-rouge">--build-arg</code></a></td>
    <td></td>
    <td>Set build-time variables</td>
  </tr>

  
  
  
  
  
  
  <tr>
    <td><a href="#build-context"><code class="language-plaintext highlighter-rouge">--build-context</code></a></td>
    <td></td>
    <td>Additional build contexts (e.g., name=path)</td>
  </tr>

  
  
  
  
  
  
  <tr>
    <td><a href="#cache-from"><code class="language-plaintext highlighter-rouge">--cache-from</code></a></td>
    <td></td>
    <td>External cache sources (e.g., <code class="language-plaintext highlighter-rouge">user/app:cache</code>, <code class="language-plaintext highlighter-rouge">type=local,src=path/to/dir</code>)</td>
  </tr>

  
  
  
  
  
  
  <tr>
    <td><a href="#cache-to"><code class="language-plaintext highlighter-rouge">--cache-to</code></a></td>
    <td></td>
    <td>Cache export destinations (e.g., <code class="language-plaintext highlighter-rouge">user/app:cache</code>, <code class="language-plaintext highlighter-rouge">type=local,dest=path/to/dir</code>)</td>
  </tr>

  
  
  
  
  
  
  <tr>
    <td><a href="/engine/reference/commandline/build/#use-a-custom-parent-cgroup---cgroup-parent"><code class="language-plaintext highlighter-rouge">--cgroup-parent</code></a></td>
    <td></td>
    <td>Optional parent cgroup for the container</td>
  </tr>

  
  
  
  
  
  
  <tr>
    <td><code class="language-plaintext highlighter-rouge">--compress</code></td>
    <td></td>
    <td>Compress the build context using gzip</td>
  </tr>

  
  
  
  
  
  
  <tr>
    <td><code class="language-plaintext highlighter-rouge">--cpu-period</code></td>
    <td></td>
    <td>Limit the CPU CFS (Completely Fair Scheduler) period</td>
  </tr>

  
  
  
  
  
  
  <tr>
    <td><code class="language-plaintext highlighter-rouge">--cpu-quota</code></td>
    <td></td>
    <td>Limit the CPU CFS (Completely Fair Scheduler) quota</td>
  </tr>

  
  
  
  
  
  
  <tr>
    <td><code class="language-plaintext highlighter-rouge">--cpu-shares</code> , <code class="language-plaintext highlighter-rouge">-c</code></td>
    <td></td>
    <td>CPU shares (relative weight)</td>
  </tr>

  
  
  
  
  
  
  <tr>
    <td><code class="language-plaintext highlighter-rouge">--cpuset-cpus</code></td>
    <td></td>
    <td>CPUs in which to allow execution (<code class="language-plaintext highlighter-rouge">0-3</code>, <code class="language-plaintext highlighter-rouge">0,1</code>)</td>
  </tr>

  
  
  
  
  
  
  <tr>
    <td><code class="language-plaintext highlighter-rouge">--cpuset-mems</code></td>
    <td></td>
    <td>MEMs in which to allow execution (<code class="language-plaintext highlighter-rouge">0-3</code>, <code class="language-plaintext highlighter-rouge">0,1</code>)</td>
  </tr>

  
  
  
  
  
  
  <tr>
    <td><a href="/engine/reference/commandline/build/#specify-a-dockerfile--f"><code class="language-plaintext highlighter-rouge">--file</code></a> , <a href="/engine/reference/commandline/build/#specify-a-dockerfile--f"><code class="language-plaintext highlighter-rouge">-f</code></a></td>
    <td></td>
    <td>Name of the Dockerfile (default: <code class="language-plaintext highlighter-rouge">PATH/Dockerfile</code>)</td>
  </tr>

  
  
  
  
  
  
  <tr>
    <td><code class="language-plaintext highlighter-rouge">--force-rm</code></td>
    <td></td>
    <td>Always remove intermediate containers</td>
  </tr>

  
  
  
  
  
  
  <tr>
    <td><code class="language-plaintext highlighter-rouge">--iidfile</code></td>
    <td></td>
    <td>Write the image ID to the file</td>
  </tr>

  
  
  
  
  
  
  <tr>
    <td><code class="language-plaintext highlighter-rouge">--isolation</code></td>
    <td></td>
    <td>Container isolation technology</td>
  </tr>

  
  
  
  
  
  
  <tr>
    <td><code class="language-plaintext highlighter-rouge">--label</code></td>
    <td></td>
    <td>Set metadata for an image</td>
  </tr>

  
  
  
  
  
  
  <tr>
    <td><a href="#load"><code class="language-plaintext highlighter-rouge">--load</code></a></td>
    <td></td>
    <td>Shorthand for <code class="language-plaintext highlighter-rouge">--output=type=docker</code></td>
  </tr>

  
  
  
  
  
  
  <tr>
    <td><code class="language-plaintext highlighter-rouge">--memory</code> , <code class="language-plaintext highlighter-rouge">-m</code></td>
    <td></td>
    <td>Memory limit</td>
  </tr>

  
  
  
  
  
  
  <tr>
    <td><code class="language-plaintext highlighter-rouge">--memory-swap</code></td>
    <td></td>
    <td>Swap limit equal to memory plus swap: <code class="language-plaintext highlighter-rouge">-1</code> to enable unlimited swap</td>
  </tr>

  
  
  
  
  
  
  <tr>
    <td><a href="#metadata-file"><code class="language-plaintext highlighter-rouge">--metadata-file</code></a></td>
    <td></td>
    <td>Write build result metadata to the file</td>
  </tr>

  
  
  
  
  
  
  <tr>
    <td><code class="language-plaintext highlighter-rouge">--network</code></td>
    <td></td>
    <td>Set the networking mode for the <code class="language-plaintext highlighter-rouge">RUN</code> instructions during build</td>
  </tr>

  
  
  
  
  
  
  <tr>
    <td><code class="language-plaintext highlighter-rouge">--no-cache</code></td>
    <td></td>
    <td>Do not use cache when building the image</td>
  </tr>

  
  
  
  
  
  
  <tr>
    <td><code class="language-plaintext highlighter-rouge">--no-cache-filter</code></td>
    <td></td>
    <td>Do not cache specified stages</td>
  </tr>

  
  
  
  
  
  
  <tr>
    <td><a href="#output"><code class="language-plaintext highlighter-rouge">--output</code></a> , <a href="#output"><code class="language-plaintext highlighter-rouge">-o</code></a></td>
    <td></td>
    <td>Output destination (format: <code class="language-plaintext highlighter-rouge">type=local,dest=path</code>)</td>
  </tr>

  
  
  
  
  
  
  <tr>
    <td><a href="#platform"><code class="language-plaintext highlighter-rouge">--platform</code></a></td>
    <td></td>
    <td>Set target platform for build</td>
  </tr>

  
  
  
  
  
  
  <tr>
    <td><a href="#progress"><code class="language-plaintext highlighter-rouge">--progress</code></a></td>
    <td><code class="language-plaintext highlighter-rouge">auto</code></td>
    <td>Set type of progress output (<code class="language-plaintext highlighter-rouge">auto</code>, <code class="language-plaintext highlighter-rouge">plain</code>, <code class="language-plaintext highlighter-rouge">tty</code>). Use plain to show container output</td>
  </tr>

  
  
  
  
  
  
  <tr>
    <td><code class="language-plaintext highlighter-rouge">--pull</code></td>
    <td></td>
    <td>Always attempt to pull all referenced images</td>
  </tr>

  
  
  
  
  
  
  <tr>
    <td><a href="#push"><code class="language-plaintext highlighter-rouge">--push</code></a></td>
    <td></td>
    <td>Shorthand for <code class="language-plaintext highlighter-rouge">--output=type=registry</code></td>
  </tr>

  
  
  
  
  
  
  <tr>
    <td><code class="language-plaintext highlighter-rouge">--quiet</code> , <code class="language-plaintext highlighter-rouge">-q</code></td>
    <td></td>
    <td>Suppress the build output and print image ID on success</td>
  </tr>

  
  
  
  
  
  
  <tr>
    <td><code class="language-plaintext highlighter-rouge">--rm</code></td>
    <td><code class="language-plaintext highlighter-rouge">true</code></td>
    <td>Remove intermediate containers after a successful build</td>
  </tr>

  
  
  
  
  
  
  <tr>
    <td><a href="#secret"><code class="language-plaintext highlighter-rouge">--secret</code></a></td>
    <td></td>
    <td>Secret to expose to the build (format: <code class="language-plaintext highlighter-rouge">id=mysecret[,src=/local/secret]</code>)</td>
  </tr>

  
  
  
  
  
  
  <tr>
    <td><code class="language-plaintext highlighter-rouge">--security-opt</code></td>
    <td></td>
    <td>Security options</td>
  </tr>

  
  
  
  
  
  
  <tr>
    <td><a href="#shm-size"><code class="language-plaintext highlighter-rouge">--shm-size</code></a></td>
    <td></td>
    <td>Size of <code class="language-plaintext highlighter-rouge">/dev/shm</code></td>
  </tr>

  
  
  
  
  
  
  <tr>
    <td><code class="language-plaintext highlighter-rouge">--squash</code></td>
    <td></td>
    <td>Squash newly built layers into a single new layer</td>
  </tr>

  
  
  
  
  
  
  <tr>
    <td><a href="#ssh"><code class="language-plaintext highlighter-rouge">--ssh</code></a></td>
    <td></td>
    <td>SSH agent socket or keys to expose to the build (format: <code class="language-plaintext highlighter-rouge">default|&amp;lt;id&amp;gt;[=&amp;lt;socket&amp;gt;|&amp;lt;key&amp;gt;[,&amp;lt;key&amp;gt;]]</code>)</td>
  </tr>

  
  
  
  
  
  
  <tr>
    <td><a href="/engine/reference/commandline/build/#tag-an-image--t"><code class="language-plaintext highlighter-rouge">--tag</code></a> , <a href="/engine/reference/commandline/build/#tag-an-image--t"><code class="language-plaintext highlighter-rouge">-t</code></a></td>
    <td></td>
    <td>Name and optionally a tag (format: <code class="language-plaintext highlighter-rouge">name:tag</code>)</td>
  </tr>

  
  
  
  
  
  
  <tr>
    <td><a href="/engine/reference/commandline/build/#specifying-target-build-stage---target"><code class="language-plaintext highlighter-rouge">--target</code></a></td>
    <td></td>
    <td>Set the target build stage to build</td>
  </tr>

  
  
  
  
  
  
  <tr>
    <td><a href="#ulimit"><code class="language-plaintext highlighter-rouge">--ulimit</code></a></td>
    <td></td>
    <td>Ulimit options</td>
  </tr>

  
  
  
  
  
  
  <tr>
    <td><a href="#builder"><code class="language-plaintext highlighter-rouge">--builder</code></a></td>
    <td></td>
    <td>Override the configured builder instance</td>
  </tr>
 <!-- end for option -->
</tbody>
</table>
<p><!-- end if options --></p>

<h2 id="examples">Examples</h2>

<h3 id="allow">Allow extra privileged entitlement (--allow)</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>--allow=ENTITLEMENT
</code></pre></div></div>

<p>Allow extra privileged entitlement. List of entitlements:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">network.host</code> - Allows executions with host networking.</li>
  <li><code class="language-plaintext highlighter-rouge">security.insecure</code> - Allows executions without sandbox. See
<a href="https://github.com/moby/buildkit/blob/master/frontend/dockerfile/docs/experimental.md#run---securityinsecuresandbox">related Dockerfile extensions</a>.</li>
</ul>

<p>For entitlements to be enabled, the <code class="language-plaintext highlighter-rouge">buildkitd</code> daemon also needs to allow them
with <code class="language-plaintext highlighter-rouge">--allow-insecure-entitlement</code> (see <a href="/engine/reference/commandline/buildx_create/#buildkitd-flags"><code class="language-plaintext highlighter-rouge">create --buildkitd-flags</code></a>)</p>

<p><strong>Examples</strong></p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>docker buildx create <span class="nt">--use</span> <span class="nt">--name</span> insecure-builder <span class="nt">--buildkitd-flags</span> <span class="s1">'--allow-insecure-entitlement security.insecure'</span>
<span class="gp">$</span><span class="w"> </span>docker buildx build <span class="nt">--allow</span> security.insecure <span class="nb">.</span>
</code></pre></div></div>

<h3 id="build-arg">Set build-time variables (--build-arg)</h3>

<p>Same as <a href="/engine/reference/commandline/build/#set-build-time-variables---build-arg"><code class="language-plaintext highlighter-rouge">docker build</code> command</a>.</p>

<p>There are also useful built-in build args like:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">BUILDKIT_CONTEXT_KEEP_GIT_DIR=&lt;bool&gt;</code> trigger git context to keep the <code class="language-plaintext highlighter-rouge">.git</code> directory</li>
  <li><code class="language-plaintext highlighter-rouge">BUILDKIT_INLINE_BUILDINFO_ATTRS=&lt;bool&gt;</code> inline build info attributes in image config or not</li>
  <li><code class="language-plaintext highlighter-rouge">BUILDKIT_INLINE_CACHE=&lt;bool&gt;</code> inline cache metadata to image config or not</li>
  <li><code class="language-plaintext highlighter-rouge">BUILDKIT_MULTI_PLATFORM=&lt;bool&gt;</code> opt into determnistic output regardless of multi-platform output or not</li>
</ul>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>docker buildx build <span class="nt">--build-arg</span> <span class="nv">BUILDKIT_MULTI_PLATFORM</span><span class="o">=</span>1 <span class="nb">.</span>
</code></pre></div></div>

<p>More built-in build args can be found in <a href="https://github.com/moby/buildkit/blob/master/frontend/dockerfile/docs/syntax.md#built-in-build-args">dockerfile frontend docs</a>.</p>

<h3 id="build-context">Additional build contexts (--build-context)</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>--build-context=name=VALUE
</code></pre></div></div>

<p>Define additional build context with specified contents. In Dockerfile the context can be accessed when <code class="language-plaintext highlighter-rouge">FROM name</code> or <code class="language-plaintext highlighter-rouge">--from=name</code> is used.
When Dockerfile defines a stage with the same name it is overwritten.</p>

<p>The value can be a local source directory, container image (with docker-image:// prefix), Git or HTTP URL.</p>

<p>Replace <code class="language-plaintext highlighter-rouge">alpine:latest</code> with a pinned one:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>docker buildx build <span class="nt">--build-context</span> <span class="nv">alpine</span><span class="o">=</span>docker-image://alpine@sha256:0123456789 <span class="nb">.</span>
</code></pre></div></div>

<p>Expose a secondary local source directory:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>docker buildx build <span class="nt">--build-context</span> <span class="nv">project</span><span class="o">=</span>path/to/project/source <span class="nb">.</span>
<span class="gp">#</span><span class="w"> </span>docker buildx build <span class="nt">--build-context</span> <span class="nv">project</span><span class="o">=</span>https://github.com/myuser/project.git <span class="nb">.</span>
</code></pre></div></div>

<div class="language-Dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">FROM</span><span class="s"> alpine</span>
<span class="k">COPY</span><span class="s"> --from=project myfile /</span>
</code></pre></div></div>

<h3 id="builder">Override the configured builder instance (--builder)</h3>

<p>Same as <a href="/engine/reference/commandline/buildx/#builder"><code class="language-plaintext highlighter-rouge">buildx --builder</code></a>.</p>

<h3 id="cache-from">Use an external cache source for a build (--cache-from)</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>--cache-from=[NAME|type=TYPE[,KEY=VALUE]]
</code></pre></div></div>

<p>Use an external cache source for a build. Supported types are <code class="language-plaintext highlighter-rouge">registry</code>,
<code class="language-plaintext highlighter-rouge">local</code> and <code class="language-plaintext highlighter-rouge">gha</code>.</p>

<ul>
  <li><a href="https://github.com/moby/buildkit#registry-push-image-and-cache-separately"><code class="language-plaintext highlighter-rouge">registry</code> source</a>
can import cache from a cache manifest or (special) image configuration on the
registry.</li>
  <li><a href="https://github.com/moby/buildkit#local-directory-1"><code class="language-plaintext highlighter-rouge">local</code> source</a> can
import cache from local files previously exported with <code class="language-plaintext highlighter-rouge">--cache-to</code>.</li>
  <li><a href="https://github.com/moby/buildkit#github-actions-cache-experimental"><code class="language-plaintext highlighter-rouge">gha</code> source</a>
can import cache from a previously exported cache with <code class="language-plaintext highlighter-rouge">--cache-to</code> in your
GitHub repository</li>
</ul>

<p>If no type is specified, <code class="language-plaintext highlighter-rouge">registry</code> exporter is used with a specified reference.</p>

<p><code class="language-plaintext highlighter-rouge">docker</code> driver currently only supports importing build cache from the registry.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>docker buildx build <span class="nt">--cache-from</span><span class="o">=</span>user/app:cache <span class="nb">.</span>
<span class="gp">$</span><span class="w"> </span>docker buildx build <span class="nt">--cache-from</span><span class="o">=</span>user/app <span class="nb">.</span>
<span class="gp">$</span><span class="w"> </span>docker buildx build <span class="nt">--cache-from</span><span class="o">=</span><span class="nb">type</span><span class="o">=</span>registry,ref<span class="o">=</span>user/app <span class="nb">.</span>
<span class="gp">$</span><span class="w"> </span>docker buildx build <span class="nt">--cache-from</span><span class="o">=</span><span class="nb">type</span><span class="o">=</span><span class="nb">local</span>,src<span class="o">=</span>path/to/cache <span class="nb">.</span>
<span class="gp">$</span><span class="w"> </span>docker buildx build <span class="nt">--cache-from</span><span class="o">=</span><span class="nb">type</span><span class="o">=</span>gha <span class="nb">.</span>
</code></pre></div></div>

<p>More info about cache exporters and available attributes: https://github.com/moby/buildkit#export-cache</p>

<h3 id="cache-to">Export build cache to an external cache destination (--cache-to)</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>--cache-to=[NAME|type=TYPE[,KEY=VALUE]]
</code></pre></div></div>

<p>Export build cache to an external cache destination. Supported types are
<code class="language-plaintext highlighter-rouge">registry</code>, <code class="language-plaintext highlighter-rouge">local</code>, <code class="language-plaintext highlighter-rouge">inline</code> and <code class="language-plaintext highlighter-rouge">gha</code>.</p>

<ul>
  <li><a href="https://github.com/moby/buildkit#registry-push-image-and-cache-separately"><code class="language-plaintext highlighter-rouge">registry</code> type</a> exports build cache to a cache manifest in the registry.</li>
  <li><a href="https://github.com/moby/buildkit#local-directory-1"><code class="language-plaintext highlighter-rouge">local</code> type</a> type
exports cache to a local directory on the client.</li>
  <li><a href="https://github.com/moby/buildkit#inline-push-image-and-cache-together"><code class="language-plaintext highlighter-rouge">inline</code> type</a>
type writes the cache metadata into the image configuration.</li>
  <li><a href="https://github.com/moby/buildkit#github-actions-cache-experimental"><code class="language-plaintext highlighter-rouge">gha</code> type</a>
type exports cache through the <a href="https://github.com/tonistiigi/go-actions-cache/blob/master/api.md#authentication">Github Actions Cache service API</a>.</li>
</ul>

<p><code class="language-plaintext highlighter-rouge">docker</code> driver currently only supports exporting inline cache metadata to image
configuration. Alternatively, <code class="language-plaintext highlighter-rouge">--build-arg BUILDKIT_INLINE_CACHE=1</code> can be used
to trigger inline cache exporter.</p>

<p>Attribute key:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">mode</code> - Specifies how many layers are exported with the cache. <code class="language-plaintext highlighter-rouge">min</code> on only
exports layers already in the final build stage, <code class="language-plaintext highlighter-rouge">max</code> exports layers for
all stages. Metadata is always exported for the whole build.</li>
</ul>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>docker buildx build <span class="nt">--cache-to</span><span class="o">=</span>user/app:cache <span class="nb">.</span>
<span class="gp">$</span><span class="w"> </span>docker buildx build <span class="nt">--cache-to</span><span class="o">=</span><span class="nb">type</span><span class="o">=</span>inline <span class="nb">.</span>
<span class="gp">$</span><span class="w"> </span>docker buildx build <span class="nt">--cache-to</span><span class="o">=</span><span class="nb">type</span><span class="o">=</span>registry,ref<span class="o">=</span>user/app <span class="nb">.</span>
<span class="gp">$</span><span class="w"> </span>docker buildx build <span class="nt">--cache-to</span><span class="o">=</span><span class="nb">type</span><span class="o">=</span><span class="nb">local</span>,dest<span class="o">=</span>path/to/cache <span class="nb">.</span>
<span class="gp">$</span><span class="w"> </span>docker buildx build <span class="nt">--cache-to</span><span class="o">=</span><span class="nb">type</span><span class="o">=</span>gha <span class="nb">.</span>
</code></pre></div></div>

<p>More info about cache exporters and available attributes: https://github.com/moby/buildkit#export-cache</p>

<h3 id="load">Load the single-platform build result to <code class="language-plaintext highlighter-rouge">docker images</code> (--load)</h3>

<p>Shorthand for <a href="#docker"><code class="language-plaintext highlighter-rouge">--output=type=docker</code></a>. Will automatically load the
single-platform build result to <code class="language-plaintext highlighter-rouge">docker images</code>.</p>

<h3 id="metadata-file">Write build result metadata to the file (--metadata-file)</h3>

<p>To output build metadata such as the image digest, pass the <code class="language-plaintext highlighter-rouge">--metadata-file</code> flag.
The metadata will be written as a JSON object to the specified file. The
directory of the specified file must already exist and be writable.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>docker buildx build <span class="nt">--load</span> <span class="nt">--metadata-file</span> metadata.json <span class="nb">.</span>
<span class="gp">$</span><span class="w"> </span><span class="nb">cat </span>metadata.json
</code></pre></div></div>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"containerimage.buildinfo"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"frontend"</span><span class="p">:</span><span class="w"> </span><span class="s2">"dockerfile.v0"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"attrs"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"context"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://github.com/crazy-max/buildkit-buildsources-test.git#master"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"filename"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Dockerfile"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"source"</span><span class="p">:</span><span class="w"> </span><span class="s2">"docker/dockerfile:master"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"sources"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"docker-image"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"ref"</span><span class="p">:</span><span class="w"> </span><span class="s2">"docker.io/docker/buildx-bin:0.6.1@sha256:a652ced4a4141977c7daaed0a074dcd9844a78d7d2615465b12f433ae6dd29f0"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"pin"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sha256:a652ced4a4141977c7daaed0a074dcd9844a78d7d2615465b12f433ae6dd29f0"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"docker-image"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"ref"</span><span class="p">:</span><span class="w"> </span><span class="s2">"docker.io/library/alpine:3.13"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"pin"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sha256:026f721af4cf2843e07bba648e158fb35ecc876d822130633cc49f707f0fc88c"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"containerimage.config.digest"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sha256:2937f66a9722f7f4a2df583de2f8cb97fc9196059a410e7f00072fc918930e66"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"containerimage.descriptor"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"annotations"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"config.digest"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sha256:2937f66a9722f7f4a2df583de2f8cb97fc9196059a410e7f00072fc918930e66"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"org.opencontainers.image.created"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2022-02-08T21:28:03Z"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"digest"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sha256:19ffeab6f8bc9293ac2c3fdf94ebe28396254c993aea0b5a542cfb02e0883fa3"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"mediaType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"application/vnd.oci.image.manifest.v1+json"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"size"</span><span class="p">:</span><span class="w"> </span><span class="mi">506</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"containerimage.digest"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sha256:19ffeab6f8bc9293ac2c3fdf94ebe28396254c993aea0b5a542cfb02e0883fa3"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h3 id="output">Set the export action for the build result (-o, --output)</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>-o, --output=[PATH,-,type=TYPE[,KEY=VALUE]
</code></pre></div></div>

<p>Sets the export action for the build result. In <code class="language-plaintext highlighter-rouge">docker build</code> all builds finish
by creating a container image and exporting it to <code class="language-plaintext highlighter-rouge">docker images</code>. <code class="language-plaintext highlighter-rouge">buildx</code> makes
this step configurable allowing results to be exported directly to the client,
oci image tarballs, registry etc.</p>

<p>Buildx with <code class="language-plaintext highlighter-rouge">docker</code> driver currently only supports local, tarball exporter and
image exporter. <code class="language-plaintext highlighter-rouge">docker-container</code> driver supports all the exporters.</p>

<p>If just the path is specified as a value, <code class="language-plaintext highlighter-rouge">buildx</code> will use the local exporter
with this path as the destination. If the value is “-“, <code class="language-plaintext highlighter-rouge">buildx</code> will use <code class="language-plaintext highlighter-rouge">tar</code>
exporter and write to <code class="language-plaintext highlighter-rouge">stdout</code>.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>docker buildx build <span class="nt">-o</span> <span class="nb">.</span> <span class="nb">.</span>
<span class="gp">$</span><span class="w"> </span>docker buildx build <span class="nt">-o</span> outdir <span class="nb">.</span>
<span class="gp">$</span><span class="w"> </span>docker buildx build <span class="nt">-o</span> - - <span class="o">&gt;</span> out.tar
<span class="gp">$</span><span class="w"> </span>docker buildx build <span class="nt">-o</span> <span class="nb">type</span><span class="o">=</span>docker <span class="nb">.</span>
<span class="gp">$</span><span class="w"> </span>docker buildx build <span class="nt">-o</span> <span class="nb">type</span><span class="o">=</span>docker,dest<span class="o">=</span>- <span class="nb">.</span> <span class="o">&gt;</span> myimage.tar
<span class="gp">$</span><span class="w"> </span>docker buildx build <span class="nt">-t</span> tonistiigi/foo <span class="nt">-o</span> <span class="nb">type</span><span class="o">=</span>registry
</code></pre></div></div>

<p>Supported exported types are:</p>

<h4 id="local"><code class="language-plaintext highlighter-rouge">local</code></h4>

<p>The <code class="language-plaintext highlighter-rouge">local</code> export type writes all result files to a directory on the client. The
new files will be owned by the current user. On multi-platform builds, all results
will be put in subdirectories by their platform.</p>

<p>Attribute key:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">dest</code> - destination directory where files will be written</li>
</ul>

<h4 id="tar"><code class="language-plaintext highlighter-rouge">tar</code></h4>

<p>The <code class="language-plaintext highlighter-rouge">tar</code> export type writes all result files as a single tarball on the client.
On multi-platform builds all results will be put in subdirectories by their platform.</p>

<p>Attribute key:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">dest</code> - destination path where tarball will be written. “-” writes to stdout.</li>
</ul>

<h4 id="oci"><code class="language-plaintext highlighter-rouge">oci</code></h4>

<p>The <code class="language-plaintext highlighter-rouge">oci</code> export type writes the result image or manifest list as an <a href="https://github.com/opencontainers/image-spec/blob/v1.0.1/image-layout.md">OCI image
layout</a>
tarball on the client.</p>

<p>Attribute key:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">dest</code> - destination path where tarball will be written. “-” writes to stdout.</li>
</ul>

<h4 id="docker"><code class="language-plaintext highlighter-rouge">docker</code></h4>

<p>The <code class="language-plaintext highlighter-rouge">docker</code> export type writes the single-platform result image as a <a href="https://github.com/docker/docker/blob/v20.10.2/image/spec/v1.2.md">Docker image
specification</a>
tarball on the client. Tarballs created by this exporter are also OCI compatible.</p>

<p>Currently, multi-platform images cannot be exported with the <code class="language-plaintext highlighter-rouge">docker</code> export type.
The most common usecase for multi-platform images is to directly push to a registry
(see <a href="#registry"><code class="language-plaintext highlighter-rouge">registry</code></a>).</p>

<p>Attribute keys:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">dest</code> - destination path where tarball will be written. If not specified the
tar will be loaded automatically to the current docker instance.</li>
  <li><code class="language-plaintext highlighter-rouge">context</code> - name for the docker context where to import the result</li>
</ul>

<h4 id="image"><code class="language-plaintext highlighter-rouge">image</code></h4>

<p>The <code class="language-plaintext highlighter-rouge">image</code> exporter writes the build result as an image or a manifest list. When
using <code class="language-plaintext highlighter-rouge">docker</code> driver the image will appear in <code class="language-plaintext highlighter-rouge">docker images</code>. Optionally, image
can be automatically pushed to a registry by specifying attributes.</p>

<p>Attribute keys:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">name</code> - name (references) for the new image.</li>
  <li><code class="language-plaintext highlighter-rouge">push</code> - boolean to automatically push the image.</li>
</ul>

<h4 id="registry"><code class="language-plaintext highlighter-rouge">registry</code></h4>

<p>The <code class="language-plaintext highlighter-rouge">registry</code> exporter is a shortcut for <code class="language-plaintext highlighter-rouge">type=image,push=true</code>.</p>

<h3 id="platform">Set the target platforms for the build (--platform)</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>--platform=value[,value]
</code></pre></div></div>

<p>Set the target platform for the build. All <code class="language-plaintext highlighter-rouge">FROM</code> commands inside the Dockerfile
without their own <code class="language-plaintext highlighter-rouge">--platform</code> flag will pull base images for this platform and
this value will also be the platform of the resulting image. The default value
will be the current platform of the buildkit daemon.</p>

<p>When using <code class="language-plaintext highlighter-rouge">docker-container</code> driver with <code class="language-plaintext highlighter-rouge">buildx</code>, this flag can accept multiple
values as an input separated by a comma. With multiple values the result will be
built for all of the specified platforms and joined together into a single manifest
list.</p>

<p>If the <code class="language-plaintext highlighter-rouge">Dockerfile</code> needs to invoke the <code class="language-plaintext highlighter-rouge">RUN</code> command, the builder needs runtime
support for the specified platform. In a clean setup, you can only execute <code class="language-plaintext highlighter-rouge">RUN</code>
commands for your system architecture.
If your kernel supports <a href="https://en.wikipedia.org/wiki/Binfmt_misc"><code class="language-plaintext highlighter-rouge">binfmt_misc</code></a>
launchers for secondary architectures, buildx will pick them up automatically.
Docker desktop releases come with <code class="language-plaintext highlighter-rouge">binfmt_misc</code> automatically configured for <code class="language-plaintext highlighter-rouge">arm64</code>
and <code class="language-plaintext highlighter-rouge">arm</code> architectures. You can see what runtime platforms your current builder
instance supports by running <code class="language-plaintext highlighter-rouge">docker buildx inspect --bootstrap</code>.</p>

<p>Inside a <code class="language-plaintext highlighter-rouge">Dockerfile</code>, you can access the current platform value through
<code class="language-plaintext highlighter-rouge">TARGETPLATFORM</code> build argument. Please refer to the <a href="/engine/reference/builder/#automatic-platform-args-in-the-global-scope"><code class="language-plaintext highlighter-rouge">docker build</code>
documentation</a>
for the full description of automatic platform argument variants .</p>

<p>The formatting for the platform specifier is defined in the <a href="https://github.com/containerd/containerd/blob/v1.4.3/platforms/platforms.go#L63">containerd source
code</a>.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>docker buildx build <span class="nt">--platform</span><span class="o">=</span>linux/arm64 <span class="nb">.</span>
<span class="gp">$</span><span class="w"> </span>docker buildx build <span class="nt">--platform</span><span class="o">=</span>linux/amd64,linux/arm64,linux/arm/v7 <span class="nb">.</span>
<span class="gp">$</span><span class="w"> </span>docker buildx build <span class="nt">--platform</span><span class="o">=</span>darwin <span class="nb">.</span>
</code></pre></div></div>

<h3 id="progress">Set type of progress output (--progress)</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>--progress=VALUE
</code></pre></div></div>

<p>Set type of progress output (auto, plain, tty). Use plain to show container
output (default “auto”).</p>

<blockquote>
  <p>You can also use the <code class="language-plaintext highlighter-rouge">BUILDKIT_PROGRESS</code> environment variable to set
its value.</p>
</blockquote>

<p>The following example uses <code class="language-plaintext highlighter-rouge">plain</code> output during the build:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>docker buildx build <span class="nt">--load</span> <span class="nt">--progress</span><span class="o">=</span>plain <span class="nb">.</span>
<span class="go">
</span><span class="gp">#</span>1 <span class="o">[</span>internal] load build definition from Dockerfile
<span class="gp">#</span>1 transferring dockerfile: 227B 0.0s <span class="k">done</span>
<span class="gp">#</span>1 DONE 0.1s
<span class="go">
</span><span class="gp">#</span>2 <span class="o">[</span>internal] load .dockerignore
<span class="gp">#</span>2 transferring context: 129B 0.0s <span class="k">done</span>
<span class="gp">#</span>2 DONE 0.0s
<span class="c">...
</span></code></pre></div></div>

<h3 id="push">Push the build result to a registry (--push)</h3>

<p>Shorthand for <a href="#registry"><code class="language-plaintext highlighter-rouge">--output=type=registry</code></a>. Will automatically push the
build result to registry.</p>

<h3 id="secret">Secret to expose to the build (--secret)</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>--secret=[type=TYPE[,KEY=VALUE]
</code></pre></div></div>

<p>Exposes secret to the build. The secret can be used by the build using
<a href="https://github.com/moby/buildkit/blob/master/frontend/dockerfile/docs/syntax.md#run---mounttypesecret"><code class="language-plaintext highlighter-rouge">RUN --mount=type=secret</code> mount</a>.</p>

<p>If <code class="language-plaintext highlighter-rouge">type</code> is unset it will be detected. Supported types are:</p>

<h4 id="file"><code class="language-plaintext highlighter-rouge">file</code></h4>

<p>Attribute keys:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">id</code> - ID of the secret. Defaults to basename of the <code class="language-plaintext highlighter-rouge">src</code> path.</li>
  <li><code class="language-plaintext highlighter-rouge">src</code>, <code class="language-plaintext highlighter-rouge">source</code> - Secret filename. <code class="language-plaintext highlighter-rouge">id</code> used if unset.</li>
</ul>

<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># syntax=docker/dockerfile:1.4</span>
<span class="k">FROM</span><span class="s"> python:3</span>
<span class="k">RUN </span>pip <span class="nb">install </span>awscli
<span class="k">RUN </span><span class="nt">--mount</span><span class="o">=</span><span class="nb">type</span><span class="o">=</span>secret,id<span class="o">=</span>aws,target<span class="o">=</span>/root/.aws/credentials <span class="se">\
</span>  aws s3 <span class="nb">cp </span>s3://... ...
</code></pre></div></div>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>docker buildx build <span class="nt">--secret</span> <span class="nb">id</span><span class="o">=</span>aws,src<span class="o">=</span><span class="nv">$HOME</span>/.aws/credentials <span class="nb">.</span>
</code></pre></div></div>

<h4 id="env"><code class="language-plaintext highlighter-rouge">env</code></h4>

<p>Attribute keys:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">id</code> - ID of the secret. Defaults to <code class="language-plaintext highlighter-rouge">env</code> name.</li>
  <li><code class="language-plaintext highlighter-rouge">env</code> - Secret environment variable. <code class="language-plaintext highlighter-rouge">id</code> used if unset, otherwise will look for <code class="language-plaintext highlighter-rouge">src</code>, <code class="language-plaintext highlighter-rouge">source</code> if <code class="language-plaintext highlighter-rouge">id</code> unset.</li>
</ul>

<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># syntax=docker/dockerfile:1.4</span>
<span class="k">FROM</span><span class="s"> node:alpine</span>
<span class="k">RUN </span><span class="nt">--mount</span><span class="o">=</span><span class="nb">type</span><span class="o">=</span><span class="nb">bind</span>,target<span class="o">=</span><span class="nb">.</span> <span class="se">\
</span>  <span class="nt">--mount</span><span class="o">=</span><span class="nb">type</span><span class="o">=</span>secret,id<span class="o">=</span>SECRET_TOKEN <span class="se">\
</span>  <span class="nv">SECRET_TOKEN</span><span class="o">=</span><span class="si">$(</span><span class="nb">cat</span> /run/secrets/SECRET_TOKEN<span class="si">)</span> yarn run <span class="nb">test</span>
</code></pre></div></div>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span><span class="nv">SECRET_TOKEN</span><span class="o">=</span>token docker buildx build <span class="nt">--secret</span> <span class="nb">id</span><span class="o">=</span>SECRET_TOKEN <span class="nb">.</span>
</code></pre></div></div>

<h3 id="shm-size">Size of /dev/shm (--shm-size)</h3>

<p>The format is <code class="language-plaintext highlighter-rouge">&lt;number&gt;&lt;unit&gt;</code>. <code class="language-plaintext highlighter-rouge">number</code> must be greater than <code class="language-plaintext highlighter-rouge">0</code>. Unit is
optional and can be <code class="language-plaintext highlighter-rouge">b</code> (bytes), <code class="language-plaintext highlighter-rouge">k</code> (kilobytes), <code class="language-plaintext highlighter-rouge">m</code> (megabytes), or <code class="language-plaintext highlighter-rouge">g</code>
(gigabytes). If you omit the unit, the system uses bytes.</p>

<h3 id="ssh">SSH agent socket or keys to expose to the build (--ssh)</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>--ssh=default|&lt;id&gt;[=&lt;socket&gt;|&lt;key&gt;[,&lt;key&gt;]]
</code></pre></div></div>

<p>This can be useful when some commands in your Dockerfile need specific SSH
authentication (e.g., cloning a private repository).</p>

<p><code class="language-plaintext highlighter-rouge">--ssh</code> exposes SSH agent socket or keys to the build and can be used with the
<a href="https://github.com/moby/buildkit/blob/master/frontend/dockerfile/docs/syntax.md#run---mounttypessh"><code class="language-plaintext highlighter-rouge">RUN --mount=type=ssh</code> mount</a>.</p>

<p>Example to access Gitlab using an SSH agent socket:</p>

<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># syntax=docker/dockerfile:1.4</span>
<span class="k">FROM</span><span class="s"> alpine</span>
<span class="k">RUN </span>apk add <span class="nt">--no-cache</span> openssh-client
<span class="k">RUN </span><span class="nb">mkdir</span> <span class="nt">-p</span> <span class="nt">-m</span> 0700 ~/.ssh <span class="o">&amp;&amp;</span> ssh-keyscan gitlab.com <span class="o">&gt;&gt;</span> ~/.ssh/known_hosts
<span class="k">RUN </span><span class="nt">--mount</span><span class="o">=</span><span class="nb">type</span><span class="o">=</span>ssh ssh <span class="nt">-q</span> <span class="nt">-T</span> git@gitlab.com 2&gt;&amp;1 | <span class="nb">tee</span> /hello
<span class="c"># "Welcome to GitLab, @GITLAB_USERNAME_ASSOCIATED_WITH_SSHKEY" should be printed here</span>
<span class="c"># with the type of build progress is defined as `plain`.</span>
</code></pre></div></div>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span><span class="nb">eval</span> <span class="si">$(</span>ssh-agent<span class="si">)</span>
<span class="gp">$</span><span class="w"> </span>ssh-add ~/.ssh/id_rsa
<span class="go">(Input your passphrase here)
</span><span class="gp">$</span><span class="w"> </span>docker buildx build <span class="nt">--ssh</span> <span class="nv">default</span><span class="o">=</span><span class="nv">$SSH_AUTH_SOCK</span> <span class="nb">.</span>
</code></pre></div></div>

<h3 id="ulimit">Set ulimits (--ulimit)</h3>

<p><code class="language-plaintext highlighter-rouge">--ulimit</code> is specified with a soft and hard limit as such:
<code class="language-plaintext highlighter-rouge">&lt;type&gt;=&lt;soft limit&gt;[:&lt;hard limit&gt;]</code>, for example:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>docker buildx build <span class="nt">--ulimit</span> <span class="nv">nofile</span><span class="o">=</span>1024:1024 <span class="nb">.</span>
</code></pre></div></div>

<blockquote>
  <p><strong>Note</strong></p>

  <p>If you do not provide a <code class="language-plaintext highlighter-rouge">hard limit</code>, the <code class="language-plaintext highlighter-rouge">soft limit</code> is used
for both values. If no <code class="language-plaintext highlighter-rouge">ulimits</code> are set, they are inherited from
the default <code class="language-plaintext highlighter-rouge">ulimits</code> set on the daemon.</p>
</blockquote>

<h2 id="parent-command">Parent command</h2>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Command</th>
      <th style="text-align: left">Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><a href="/engine/reference/commandline/buildx/">docker buildx</a></td>
      <td style="text-align: left">Docker Buildx</td>
    </tr>
  </tbody>
</table>

<h2 id="related-commands">Related commands</h2>

<table>
<thead>
  <tr>
    <td>Command</td>
    <td>Description</td>
  </tr>
</thead>
<tbody>

  
  <tr>
    <td><a href="/engine/reference/commandline/buildx_bake/">docker buildx bake</a></td>
    <td>Build from a file</td>
  </tr>

  
  <tr>
    <td><a href="/engine/reference/commandline/buildx_build/">docker buildx build</a></td>
    <td>Start a build</td>
  </tr>

  
  <tr>
    <td><a href="/engine/reference/commandline/buildx_create/">docker buildx create</a></td>
    <td>Create a new builder instance</td>
  </tr>

  
  <tr>
    <td><a href="/engine/reference/commandline/buildx_du/">docker buildx du</a></td>
    <td>Disk usage</td>
  </tr>

  
  <tr>
    <td><a href="/engine/reference/commandline/buildx_imagetools/">docker buildx imagetools</a></td>
    <td>Commands to work on images in registry</td>
  </tr>

  
  <tr>
    <td><a href="/engine/reference/commandline/buildx_inspect/">docker buildx inspect</a></td>
    <td>Inspect current builder instance</td>
  </tr>

  
  <tr>
    <td><a href="/engine/reference/commandline/buildx_ls/">docker buildx ls</a></td>
    <td>List builder instances</td>
  </tr>

  
  <tr>
    <td><a href="/engine/reference/commandline/buildx_prune/">docker buildx prune</a></td>
    <td>Remove build cache</td>
  </tr>

  
  <tr>
    <td><a href="/engine/reference/commandline/buildx_rm/">docker buildx rm</a></td>
    <td>Remove a builder instance</td>
  </tr>

  
  <tr>
    <td><a href="/engine/reference/commandline/buildx_stop/">docker buildx stop</a></td>
    <td>Stop builder instance</td>
  </tr>

  
  <tr>
    <td><a href="/engine/reference/commandline/buildx_use/">docker buildx use</a></td>
    <td>Set the current builder instance</td>
  </tr>

  
  <tr>
    <td><a href="/engine/reference/commandline/buildx_version/">docker buildx version</a></td>
    <td>Show buildx version information</td>
  </tr>

</tbody>
</table>

</section>
                    </main>
                    <nav class="col-nav">
                        <div id="sidebar-nav" class="sidebar hidden-sm hidden-xs">
                            <div id="navbar" class="nav-sidebar">
                                <ul class="nav hidden-md hidden-lg"></ul>
                                <ul class="nav" id="jsTOCLeftNav"></ul>
                            </div>
                        </div>
                    </nav>
                    <div class="col-toc">
                        <div class="sidebar hidden-xs hidden-sm">
                            <div class="toc-nav">
                                <div class="feedback-links">
                                    <ul><li><a href="https://github.com/docker/cli/tree/master/docs/reference/commandline"><i class="fa fa-pencil-square-o" aria-hidden="true"></i> Edit this page</a></li><li><a href="https://github.com/docker/docker.github.io/issues/new?body=File: [engine/reference/commandline/buildx_build.md](https://docs.docker.com/engine/reference/commandline/buildx_build/)" class="nomunge"><i class="fa fa-check" aria-hidden="true"></i> Request docs changes</a></li><li><div class="toggle-mode">
  <div class="icon">
      <i class="fa fa-sun-o" aria-hidden="true"></i>
  </div>
  <div class="toggle-switch">
      <label class="switch">
          <input type="checkbox" id="switch-style">
          <span class="slider round"></span>
      </label>
  </div>
  <div class="icon">
      <i class="fa fa-moon-o" aria-hidden="true"></i>
  </div>
</div>
</li>
                                    </ul>
                                </div><div id="side-toc-title">On this page:</div>
<ul id="my_toc" class="inline_toc">
  <li><a href="#usage" class="nomunge">Usage</a></li>
  <li><a href="#description" class="nomunge">Description</a></li>
  <li><a href="#options" class="nomunge">Options</a></li>
  <li><a href="#examples" class="nomunge">Examples</a>
    <ul>
      <li><a href="#allow" class="nomunge">Allow extra privileged entitlement (--allow)</a></li>
      <li><a href="#build-arg" class="nomunge">Set build-time variables (--build-arg)</a></li>
      <li><a href="#build-context" class="nomunge">Additional build contexts (--build-context)</a></li>
      <li><a href="#builder" class="nomunge">Override the configured builder instance (--builder)</a></li>
      <li><a href="#cache-from" class="nomunge">Use an external cache source for a build (--cache-from)</a></li>
      <li><a href="#cache-to" class="nomunge">Export build cache to an external cache destination (--cache-to)</a></li>
      <li><a href="#load" class="nomunge">Load the single-platform build result to docker images (--load)</a></li>
      <li><a href="#metadata-file" class="nomunge">Write build result metadata to the file (--metadata-file)</a></li>
      <li><a href="#output" class="nomunge">Set the export action for the build result (-o, --output)</a>
        <ul>
          <li><a href="#local" class="nomunge">local</a></li>
          <li><a href="#tar" class="nomunge">tar</a></li>
          <li><a href="#oci" class="nomunge">oci</a></li>
          <li><a href="#docker" class="nomunge">docker</a></li>
          <li><a href="#image" class="nomunge">image</a></li>
          <li><a href="#registry" class="nomunge">registry</a></li>
        </ul>
      </li>
      <li><a href="#platform" class="nomunge">Set the target platforms for the build (--platform)</a></li>
      <li><a href="#progress" class="nomunge">Set type of progress output (--progress)</a></li>
      <li><a href="#push" class="nomunge">Push the build result to a registry (--push)</a></li>
      <li><a href="#secret" class="nomunge">Secret to expose to the build (--secret)</a>
        <ul>
          <li><a href="#file" class="nomunge">file</a></li>
          <li><a href="#env" class="nomunge">env</a></li>
        </ul>
      </li>
      <li><a href="#shm-size" class="nomunge">Size of /dev/shm (--shm-size)</a></li>
      <li><a href="#ssh" class="nomunge">SSH agent socket or keys to expose to the build (--ssh)</a></li>
      <li><a href="#ulimit" class="nomunge">Set ulimits (--ulimit)</a></li>
    </ul>
  </li>
  <li><a href="#parent-command" class="nomunge">Parent command</a></li>
  <li><a href="#related-commands" class="nomunge">Related commands</a></li>
</ul>

</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <footer class="footer">
          
    <div class="container">
        <div class="top_footer">
            <div class="row">
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><b><a href="https://www.docker.com/products" target="_blank" rel="noopener">Product offerings</a></b></li>
                        <li><a href="https://www.docker.com/products/personal" target="_blank" rel="noopener">Docker Personal</a></li>
                        <li><a href="https://www.docker.com/products/pro" target="_blank" rel="noopener">Docker Pro</a></li>
                        <li><a href="https://www.docker.com/products/team" target="_blank" rel="noopener">Docker Team</a></li>
                        <li><a href="https://www.docker.com/products/business" target="_blank" rel="noopener">Docker Business</a></li>
                        <li><a href="https://www.docker.com/products" target="_blank" rel="noopener">Compare Subscriptions</a></li>
                        <li><b><a href="https://www.docker.com/" target="_blank" rel="noopener">Features</a></b></li>
                        <li><a href="https://www.docker.com/products/docker-desktop" target="_blank" rel="noopener">Docker Desktop</a></li>
                        <li><a href="https://www.docker.com/products/docker-hub" target="_blank" rel="noopener">Docker Hub</a></li>
                        <li><a href="https://www.docker.com/products/secure-software-supply-chain" target="_blank" rel="noopener">Secure Software Supply Chain</a></li>
                        <li><a href="https://www.docker.com/products/container-runtime" target="_blank" rel="noopener">Container Runtime</a></li>
                        <li><a href="https://www.docker.com/products/developer-tools" target="_blank" rel="noopener">Developer Tools</a></li>
                        <li><a href="https://www.docker.com/partners" target="_blank" rel="noopener">Trusted Content</a></li>
                        <li><a href="https://www.docker.com/roadmap" target="_blank" rel="noopener">Docker Product Roadmap</a></li>
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><b><a href="https://www.docker.com/products/docker-desktop" target="_blank" rel="noopener">Developers</a></b></li>
                        <li><a href="https://www.docker.com/use-cases" target="_blank" rel="noopener">Use Cases</a></li>
                        <li><a href="https://docs.docker.com/get-started/" target="_blank" rel="noopener">Get Started</a></li>
                        <li><a href="https://www.docker.com/blog/" target="_blank" rel="noopener">Blog</a></li>
                        <li><a href="https://www.docker.com/docker-community" target="_blank" rel="noopener">Community</a></li>
                        <li><a href="https://www.docker.com/open-source" target="_blank" rel="noopener">Open Source</a></li>
                        <li><a href="https://www.docker.com/community/get-involved/developer-preview" target="_blank" rel="noopener">Preview Program</a></li>
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><b><a href="https://www.docker.com/products/docker-desktop" target="_blank" rel="noopener">Pricing</a></b></li>
                        <li><a href="https://www.docker.com/pricing/faq" target="_blank" rel="noopener">FAQ</a></li>
                        <li><a href="https://www.docker.com/partners/programs" target="_blank" rel="noopener">Docker Verified Publisher</a></li>
                        <li><a href="https://www.docker.com/partners" target="_blank" rel="noopener">Partners</a></li>
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><b><a href="https://www.docker.com/company" target="_blank" rel="noopener">About Us</a></b></li>
                        <li><a href="https://www.docker.com/what-container" target="_blank" rel="noopener">What is a Container?</a></li>
                        <li><a href="https://www.docker.com/why-docker" target="_blank" rel="noopener">Why Docker?</a></li>
                        <li><a href="https://www.docker.com/events" target="_blank" rel="noopener">Virtual Events</a></li>
                        <li><a href="https://www.docker.com/swag" target="_blank" rel="noopener">Swag Store
                        </a></li>
                        <li><a href="https://www.docker.com/company/newsroom" target="_blank" rel="noopener">Newsroom</a></li>
                        <li><a href="https://www.docker.com/careers" target="_blank" rel="noopener">Careers</a></li>
                        <li><a href="https://www.docker.com/company/contact" target="_blank" rel="noopener">Contact Us</a></li>
                        <li><a href="https://www.docker.com/customers" target="_blank" rel="noopener">Customers</a></li>
                        <li><a href="https://www.docker.com/newsletter-subscription" target="_blank" rel="noopener">Newsletter</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-nav">
                <nav class="footer_sub_nav">
                    <ul class="menu">
                        <li><a href="https://www.docker.com/legal/docker-terms-service" target="_blank" rel="noopener">Terms of Service</a></li>
                        <li><a href="https://status.docker.com/" target="_blank" rel="noopener">Status</a></li>
                        <li><a href="https://www.docker.com/legal" target="_blank" rel="noopener">Legal</a></li>
                    </ul>
                </nav>
            </div>
        </div>
        <div class="bottom_footer">
            <div class="footer-copyright col-xs-12 col-md-8">
                <p class="copyright">
                    Copyright &copy; 2013-2021 Docker Inc. All rights reserved. </p>
            </div>
            <div class="footer_social_nav">
                <ul class="nav-social">
                    <li class="fa fa-twitter"><a href="https://twitter.com/docker">Twitter</a></li>
                    <li class="fa fa-youtube"><a href="https://www.youtube.com/user/dockerrun">Youtube</a></li>
                    <li class="fa fa-github"><a href="https://github.com/docker">GitHub</a></li>
                    <li class="fa fa-linkedin"><a href="https://www.linkedin.com/company/docker">Linkedin</a></li>
                    <li class="fa fa-facebook"><a href="https://www.facebook.com/docker.run">Facebook</a></li>
                    <li class="fa fa-slideshare"><a href="https://www.slideshare.net/docker">Slideshare</a></li>
                    <li class="fa fa-reddit"><a href="https://www.reddit.com/r/docker">Reddit</a></li>
                </ul>
            </div>
        </div>
    </div>

    </footer>
    <script>const pageURL = "/engine/reference/commandline/buildx_build/";</script></body>
</html>

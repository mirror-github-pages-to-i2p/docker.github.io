<!DOCTYPE html>
<!-- Page generated 2022-07-02 18:47:56 +0000-->
<html lang="en"><head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="robots" content="noindex"/><title>Configuring a registry | Docker Documentation</title>
  <meta name="description" content="Explains how to configure a registry" />
  <meta name="keywords" content="registry, on-prem, images, tags, repository, distribution, configuration">
  <link rel="canonical" href="https://localhost:4000/registry/configuration/" />

  <!-- favicon -->
  <link rel="icon" type="image/x-icon" href="/favicons/docs@2x.ico" sizes="129x128">
  <link rel="apple-touch-icon" type="image/x-icon" href="/favicons/docs@2x.ico" sizes="129x128">
  <meta name="msapplication-TileImage" content="/favicons/docs@2x.ico">
  <meta property="og:image" content="/favicons/docs@2x.ico"/>
  <meta name="theme-color" content="#2496ed" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- hide elements that are only shown without JavaScript enabled -->
  <script>document.documentElement.classList.add('js')</script>
  <style>html.js .no-js { display: none !important; }</style><script defer src="/js/theme-switcher.js"></script>
  <script defer src="/js/anchorlinks.js"></script>
  <script defer src="/js/jquery.js"></script>
  <script defer src="/js/bootstrap.min.js"></script>
  <script defer src="/js/docs.js"></script><link rel="preload" as="font" href="https://fonts.gstatic.com/s/opensans/v18/mem8YaGs126MiZpBA-UFVZ0bf8pkAg.woff2" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" as="font" href="/fonts/geomanist/hinted-Geomanist-Book.woff2"    type="font/woff2" crossorigin="anonymous">
  <link rel="preload" as="font" href="/fonts/geomanist/hinted-Geomanist-Regular.woff2" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" as="font" href="/fonts/glyphicons-halflings-regular.woff2"       type="font/woff2" crossorigin="anonymous">
  <link rel="preload" as="font" href="/fonts/fontawesome-webfont.woff2?v=4.7.0"        type="font/woff2" crossorigin="anonymous">

  <link rel="stylesheet" href="/css/font-awesome.min.css">
  <link rel="stylesheet" href="/css/bootstrap.min.css">
  <link rel="stylesheet" href="/css/style.css" id="pagestyle">

  <!-- SEO stuff -->
  <meta name="twitter:title" itemprop="title name" content="Configuring a registry"/>
  <meta name="twitter:description" property="og:description" itemprop="description" content="" />
  <meta name="twitter:card" content="summary_large_image"/>
  <meta name="twitter:domain" content="docs.docker.com"/>
  <meta name="twitter:site" content="@docker_docs"/>
  <meta name="twitter:url" content="https://twitter.com/docker_docs"/>
  <meta name="twitter:image:src" content="https://docs.docker.com/images/docs@2x.png"/>
  <meta name="twitter:image:alt" content="Docker Documentation"/>
  <meta property="og:title" content="Configuring a registry" />
  <meta property="og:description" content="Explains how to configure a registry" />
  <meta property="og:type" content="website"/>
  <meta property="og:updated_time" itemprop="dateUpdated" content="2022-07-02T18:47:56+00:00"/>
  <meta property="og:image" itemprop="image primaryImageOfPage" content="https://docs.docker.com/images/docs@2x.png"/>
  <meta property="og:locale" content="en_US" />
  <meta property="og:url" content="https://docs.docker.com/registry/configuration/" />
  <meta property="og:site_name" content="Docker Documentation" />
  <meta property="article:published_time" itemprop="datePublished" content="2022-07-02T18:47:56+00:00"/>
  <script type="application/ld+json">{"@context":"https://schema.org","@type":"WebPage","headline":"Configuring a registry","description":"Explains how to configure a registry","url":"https://docs.docker.com/registry/configuration/"}</script>
  <!-- END SEO STUFF -->
</head>
<body class="colums">
    <header>
        <nav class="nav-secondary navbar navbar-fixed-top">
    <div class="container-fluid">
        <div class="navbar-header">
            <a href="/">
                <img class="logo" src="/images/docker-docs-logo.svg" alt="Docker Docs" title="Docker Docs" width="160" height="28" />
            </a>
        </div>
        <div class="navbar-collapse" aria-expanded="false" style="height: 1px;">
            <div class="logo-mobile">
    <a href="/">
        <img src="/images/docker-icon.svg" alt="Docker Docs" title="Docker Docs" width="30" height="30" />
    </a>
</div>
<div class="search-form" id="search-div">
    <form class="search-form form-inline" id="searchForm" action="/search/" method="get">
        <label for="st-search-input" class="sr-only">Search</label>
        <input class="search-field form-control ds-input" id="st-search-input" name="q" placeholder="Search the docs" type="search" autocomplete="off" spellcheck="false" dir="auto" style="position: relative; vertical-align: top;">
        <div id="autocompleteResults"></div>
        <!-- <button type="submit" class="search-submit btn btn-default">Search</button> -->
    </form>
</div>
<div class="sidebar-toggle">
    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
    </button>
</div>
<div class="nav-container hidden-sm hidden-xs">
    <div>
        <ul class="nav navbar-nav"><li><a href="/" id="home">Home</a></li><li><a href="/get-started/overview/" id="guides">Guides</a></li><li><a href="/desktop/" id="manuals">Manuals</a></li><li><a href="/reference/" id="reference">Reference</a></li><li><a href="/samples/" id="samples">Samples</a></li></ul>
    </div>
    <div class="ctrl-right">
        <a href="javascript:void(0)" id="menu-toggle" aria-label="Current page's menu toggle"><i class="fa fa-indent" aria-hidden="true"></i></a>
    </div>
</div>
<div class="row hidden-sm hidden-xs">
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li><a href="/" title="Docker docs homepage"><i class="fa fa-home"></i></a></li>
            <li><a href="/desktop/">Manuals</a></li><li><a>Open-source projects</a></li><li><a href="/registry/">Docker Registry</a></li><li><a href="/registry/configuration/">Configure a registry</a></li></ol>
    </nav>
</div></div>
    </div>
</nav>

    </header>
    <div class="wrapper right-open">
        <div class="container-fluid">
            <div class="row">
                <div class="col-body">
                    <main class="col-content content">
                        <section class="section"><h1>Configuring a registry</h1><p><em class="reading-time">Estimated reading time: 38 minutes</em></p><p>The Registry configuration is based on a YAML file, detailed below. While it
comes with sane default values out of the box, you should review it exhaustively
before moving your systems to production.</p>

<h2 id="override-specific-configuration-options">Override specific configuration options</h2>

<p>In a typical setup where you run your Registry from the official image, you can
specify a configuration variable from the environment by passing <code class="language-plaintext highlighter-rouge">-e</code> arguments
to your <code class="language-plaintext highlighter-rouge">docker run</code> stanza or from within a Dockerfile using the <code class="language-plaintext highlighter-rouge">ENV</code>
instruction.</p>

<p>To override a configuration option, create an environment variable named
<code class="language-plaintext highlighter-rouge">REGISTRY_variable</code> where <code class="language-plaintext highlighter-rouge">variable</code> is the name of the configuration option
and the <code class="language-plaintext highlighter-rouge">_</code> (underscore) represents indention levels. For example, you can
configure the <code class="language-plaintext highlighter-rouge">rootdirectory</code> of the <code class="language-plaintext highlighter-rouge">filesystem</code> storage backend:</p>

<pre><code class="language-none">storage:
  filesystem:
    rootdirectory: /var/lib/registry
</code></pre>

<p>To override this value, set an environment variable like this:</p>

<pre><code class="language-none">REGISTRY_STORAGE_FILESYSTEM_ROOTDIRECTORY=/somewhere
</code></pre>

<p>This variable overrides the <code class="language-plaintext highlighter-rouge">/var/lib/registry</code> value to the <code class="language-plaintext highlighter-rouge">/somewhere</code>
directory.</p>

<blockquote>
  <p><strong>Note</strong>: Create a base configuration file with environment variables that can
be configured to tweak individual values. Overriding configuration sections
with environment variables is not recommended.</p>
</blockquote>

<h2 id="overriding-the-entire-configuration-file">Overriding the entire configuration file</h2>

<p>If the default configuration is not a sound basis for your usage, or if you are
having issues overriding keys from the environment, you can specify an alternate
YAML configuration file by mounting it as a volume in the container.</p>

<p>Typically, create a new configuration file from scratch,named <code class="language-plaintext highlighter-rouge">config.yml</code>, then
specify it in the <code class="language-plaintext highlighter-rouge">docker run</code> command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker run <span class="nt">-d</span> <span class="nt">-p</span> 5000:5000 <span class="nt">--restart</span><span class="o">=</span>always <span class="nt">--name</span> registry <span class="se">\</span>
             <span class="nt">-v</span> <span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span>/config.yml:/etc/docker/registry/config.yml <span class="se">\</span>
             registry:2
</code></pre></div></div>

<p>Use this
<a href="https://github.com/docker/distribution/blob/master/cmd/registry/config-example.yml">example YAML file</a>
as a starting point.</p>

<h2 id="list-of-configuration-options">List of configuration options</h2>

<p>These are all configuration options for the registry. Some options in the list
are mutually exclusive. Read the detailed reference information about each
option before finalizing your configuration.</p>

<pre><code class="language-none">version: 0.1
log:
  accesslog:
    disabled: true
  level: debug
  formatter: text
  fields:
    service: registry
    environment: staging
  hooks:
    - type: mail
      disabled: true
      levels:
        - panic
      options:
        smtp:
          addr: mail.example.com:25
          username: mailuser
          password: password
          insecure: true
        from: sender@example.com
        to:
          - errors@example.com
loglevel: debug # deprecated: use "log"
storage:
  filesystem:
    rootdirectory: /var/lib/registry
    maxthreads: 100
  azure:
    accountname: accountname
    accountkey: base64encodedaccountkey
    container: containername
  gcs:
    bucket: bucketname
    keyfile: /path/to/keyfile
    credentials:
      type: service_account
      project_id: project_id_string
      private_key_id: private_key_id_string
      private_key: private_key_string
      client_email: client@example.com
      client_id: client_id_string
      auth_uri: http://example.com/auth_uri
      token_uri: http://example.com/token_uri
      auth_provider_x509_cert_url: http://example.com/provider_cert_url
      client_x509_cert_url: http://example.com/client_cert_url
    rootdirectory: /gcs/object/name/prefix
    chunksize: 5242880
  s3:
    accesskey: awsaccesskey
    secretkey: awssecretkey
    region: us-west-1
    regionendpoint: http://myobjects.local
    bucket: bucketname
    encrypt: true
    keyid: mykeyid
    secure: true
    v4auth: true
    chunksize: 5242880
    multipartcopychunksize: 33554432
    multipartcopymaxconcurrency: 100
    multipartcopythresholdsize: 33554432
    rootdirectory: /s3/object/name/prefix
  swift:
    username: username
    password: password
    authurl: https://storage.myprovider.com/auth/v1.0 or https://storage.myprovider.com/v2.0 or https://storage.myprovider.com/v3/auth
    tenant: tenantname
    tenantid: tenantid
    domain: domain name for Openstack Identity v3 API
    domainid: domain id for Openstack Identity v3 API
    insecureskipverify: true
    region: fr
    container: containername
    rootdirectory: /swift/object/name/prefix
  oss:
    accesskeyid: accesskeyid
    accesskeysecret: accesskeysecret
    region: OSS region name
    endpoint: optional endpoints
    internal: optional internal endpoint
    bucket: OSS bucket
    encrypt: optional data encryption setting
    secure: optional ssl setting
    chunksize: optional size valye
    rootdirectory: optional root directory
  inmemory:  # This driver takes no parameters
  delete:
    enabled: false
  redirect:
    disable: false
  cache:
    blobdescriptor: redis
  maintenance:
    uploadpurging:
      enabled: true
      age: 168h
      interval: 24h
      dryrun: false
    readonly:
      enabled: false
auth:
  silly:
    realm: silly-realm
    service: silly-service
  token:
    autoredirect: true
    realm: token-realm
    service: token-service
    issuer: registry-token-issuer
    rootcertbundle: /root/certs/bundle
  htpasswd:
    realm: basic-realm
    path: /path/to/htpasswd
middleware:
  registry:
    - name: ARegistryMiddleware
      options:
        foo: bar
  repository:
    - name: ARepositoryMiddleware
      options:
        foo: bar
  storage:
    - name: cloudfront
      options:
        baseurl: https://my.cloudfronted.domain.com/
        privatekey: /path/to/pem
        keypairid: cloudfrontkeypairid
        duration: 3000s
        ipfilteredby: awsregion
        awsregion: us-east-1, use-east-2
        updatefrenquency: 12h
        iprangesurl: https://ip-ranges.amazonaws.com/ip-ranges.json
  storage:
    - name: redirect
      options:
        baseurl: https://example.com/
reporting:
  bugsnag:
    apikey: bugsnagapikey
    releasestage: bugsnagreleasestage
    endpoint: bugsnagendpoint
  newrelic:
    licensekey: newreliclicensekey
    name: newrelicname
    verbose: true
http:
  addr: localhost:5000
  prefix: /my/nested/registry/
  host: https://myregistryaddress.org:5000
  secret: asecretforlocaldevelopment
  relativeurls: false
  draintimeout: 60s
  tls:
    certificate: /path/to/x509/public
    key: /path/to/x509/private
    clientcas:
      - /path/to/ca.pem
      - /path/to/another/ca.pem
    letsencrypt:
      cachefile: /path/to/cache-file
      email: emailused@letsencrypt.com
      hosts: [myregistryaddress.org]
  debug:
    addr: localhost:5001
    prometheus:
      enabled: true
      path: /metrics
  headers:
    X-Content-Type-Options: [nosniff]
  http2:
    disabled: false
notifications:
  events:
    includereferences: true
  endpoints:
    - name: alistener
      disabled: false
      url: https://my.listener.com/event
      headers: &lt;http.Header&gt;
      timeout: 1s
      threshold: 10
      backoff: 1s
      ignoredmediatypes:
        - application/octet-stream
      ignore:
        mediatypes:
           - application/octet-stream
        actions:
           - pull
redis:
  addr: localhost:6379
  password: asecret
  db: 0
  dialtimeout: 10ms
  readtimeout: 10ms
  writetimeout: 10ms
  pool:
    maxidle: 16
    maxactive: 64
    idletimeout: 300s
health:
  storagedriver:
    enabled: true
    interval: 10s
    threshold: 3
  file:
    - file: /path/to/checked/file
      interval: 10s
  http:
    - uri: http://server.to.check/must/return/200
      headers:
        Authorization: [Basic QWxhZGRpbjpvcGVuIHNlc2FtZQ==]
      statuscode: 200
      timeout: 3s
      interval: 10s
      threshold: 3
  tcp:
    - addr: redis-server.domain.com:6379
      timeout: 3s
      interval: 10s
      threshold: 3
proxy:
  remoteurl: https://registry-1.docker.io
  username: [username]
  password: [password]
compatibility:
  schema1:
    signingkeyfile: /etc/registry/key.json
    enabled: true
validation:
  manifests:
    urls:
      allow:
        - ^https?://([^/]+\.)*example\.com/
      deny:
        - ^https?://www\.example\.com/
</code></pre>

<p>In some instances a configuration option is <strong>optional</strong> but it contains child
options marked as <strong>required</strong>. In these cases, you can omit the parent with
all its children. However, if the parent is included, you must also include all
the children marked <strong>required</strong>.</p>

<h2 id="version"><code class="language-plaintext highlighter-rouge">version</code></h2>

<pre><code class="language-none">version: 0.1
</code></pre>

<p>The <code class="language-plaintext highlighter-rouge">version</code> option is <strong>required</strong>. It specifies the configuration’s version.
It is expected to remain a top-level field, to allow for a consistent version
check before parsing the remainder of the configuration file.</p>

<h2 id="log"><code class="language-plaintext highlighter-rouge">log</code></h2>

<p>The <code class="language-plaintext highlighter-rouge">log</code> subsection configures the behavior of the logging system. The logging
system outputs everything to stdout. You can adjust the granularity and format
with this configuration section.</p>

<pre><code class="language-none">log:
  accesslog:
    disabled: true
  level: debug
  formatter: text
  fields:
    service: registry
    environment: staging
</code></pre>

<table>
  <thead>
    <tr>
      <th>Parameter</th>
      <th>Required</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">level</code></td>
      <td>no</td>
      <td>Sets the sensitivity of logging output. Permitted values are <code class="language-plaintext highlighter-rouge">error</code>, <code class="language-plaintext highlighter-rouge">warn</code>, <code class="language-plaintext highlighter-rouge">info</code>, and <code class="language-plaintext highlighter-rouge">debug</code>. The default is <code class="language-plaintext highlighter-rouge">info</code>.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">formatter</code></td>
      <td>no</td>
      <td>This selects the format of logging output. The format primarily affects how keyed attributes for a log line are encoded. Options are <code class="language-plaintext highlighter-rouge">text</code>, <code class="language-plaintext highlighter-rouge">json</code>, and <code class="language-plaintext highlighter-rouge">logstash</code>. The default is <code class="language-plaintext highlighter-rouge">text</code>.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">fields</code></td>
      <td>no</td>
      <td>A map of field names to values. These are added to every log line for the context. This is useful for identifying log messages source after being mixed in other systems.</td>
    </tr>
  </tbody>
</table>

<h3 id="accesslog"><code class="language-plaintext highlighter-rouge">accesslog</code></h3>

<pre><code class="language-none">accesslog:
  disabled: true
</code></pre>

<p>Within <code class="language-plaintext highlighter-rouge">log</code>, <code class="language-plaintext highlighter-rouge">accesslog</code> configures the behavior of the access logging
system. By default, the access logging system outputs to stdout in
<a href="https://httpd.apache.org/docs/2.4/logs.html#combined">Combined Log Format</a>.
Access logging can be disabled by setting the boolean flag <code class="language-plaintext highlighter-rouge">disabled</code> to <code class="language-plaintext highlighter-rouge">true</code>.</p>

<h2 id="hooks"><code class="language-plaintext highlighter-rouge">hooks</code></h2>

<pre><code class="language-none">hooks:
  - type: mail
    levels:
      - panic
    options:
      smtp:
        addr: smtp.sendhost.com:25
        username: sendername
        password: password
        insecure: true
      from: name@sendhost.com
      to:
        - name@receivehost.com
</code></pre>

<p>The <code class="language-plaintext highlighter-rouge">hooks</code> subsection configures the logging hooks’ behavior. This subsection
includes a sequence handler which you can use for sending mail, for example.
Refer to <code class="language-plaintext highlighter-rouge">loglevel</code> to configure the level of messages printed.</p>

<h2 id="loglevel"><code class="language-plaintext highlighter-rouge">loglevel</code></h2>

<blockquote>
  <p><strong>DEPRECATED:</strong> Please use <a href="#log">log</a> instead.</p>
</blockquote>

<pre><code class="language-none">loglevel: debug
</code></pre>

<p>Permitted values are <code class="language-plaintext highlighter-rouge">error</code>, <code class="language-plaintext highlighter-rouge">warn</code>, <code class="language-plaintext highlighter-rouge">info</code> and <code class="language-plaintext highlighter-rouge">debug</code>. The default is
<code class="language-plaintext highlighter-rouge">info</code>.</p>

<h2 id="storage"><code class="language-plaintext highlighter-rouge">storage</code></h2>

<pre><code class="language-none">storage:
  filesystem:
    rootdirectory: /var/lib/registry
  azure:
    accountname: accountname
    accountkey: base64encodedaccountkey
    container: containername
  gcs:
    bucket: bucketname
    keyfile: /path/to/keyfile
    credentials:
      type: service_account
      project_id: project_id_string
      private_key_id: private_key_id_string
      private_key: private_key_string
      client_email: client@example.com
      client_id: client_id_string
      auth_uri: http://example.com/auth_uri
      token_uri: http://example.com/token_uri
      auth_provider_x509_cert_url: http://example.com/provider_cert_url
      client_x509_cert_url: http://example.com/client_cert_url
    rootdirectory: /gcs/object/name/prefix
  s3:
    accesskey: awsaccesskey
    secretkey: awssecretkey
    region: us-west-1
    regionendpoint: http://myobjects.local
    bucket: bucketname
    encrypt: true
    keyid: mykeyid
    secure: true
    v4auth: true
    chunksize: 5242880
    multipartcopychunksize: 33554432
    multipartcopymaxconcurrency: 100
    multipartcopythresholdsize: 33554432
    rootdirectory: /s3/object/name/prefix
  swift:
    username: username
    password: password
    authurl: https://storage.myprovider.com/auth/v1.0 or https://storage.myprovider.com/v2.0 or https://storage.myprovider.com/v3/auth
    tenant: tenantname
    tenantid: tenantid
    domain: domain name for Openstack Identity v3 API
    domainid: domain id for Openstack Identity v3 API
    insecureskipverify: true
    region: fr
    container: containername
    rootdirectory: /swift/object/name/prefix
  oss:
    accesskeyid: accesskeyid
    accesskeysecret: accesskeysecret
    region: OSS region name
    endpoint: optional endpoints
    internal: optional internal endpoint
    bucket: OSS bucket
    encrypt: optional data encryption setting
    secure: optional ssl setting
    chunksize: optional size valye
    rootdirectory: optional root directory
  inmemory:
  delete:
    enabled: false
  cache:
    blobdescriptor: inmemory
  maintenance:
    uploadpurging:
      enabled: true
      age: 168h
      interval: 24h
      dryrun: false
    readonly:
      enabled: false
  redirect:
    disable: false
</code></pre>

<p>The <code class="language-plaintext highlighter-rouge">storage</code> option is <strong>required</strong> and defines which storage backend is in
use. You must configure exactly one backend. If you configure more, the registry
returns an error. You can choose any of these backend storage drivers:</p>

<table>
  <thead>
    <tr>
      <th>Storage driver</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">filesystem</code></td>
      <td>Uses the local disk to store registry files. It is ideal for development and may be appropriate for some small-scale production applications. See the <a href="https://github.com/docker/docker.github.io/tree/master/registry/storage-drivers/filesystem.md">driver’s reference documentation</a>.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">azure</code></td>
      <td>Uses Microsoft Azure Blob Storage. See the <a href="https://github.com/docker/docker.github.io/tree/master/registry/storage-drivers/azure.md">driver’s reference documentation</a>.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">gcs</code></td>
      <td>Uses Google Cloud Storage. See the <a href="https://github.com/docker/docker.github.io/tree/master/registry/storage-drivers/gcs.md">driver’s reference documentation</a>.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">s3</code></td>
      <td>Uses Amazon Simple Storage Service (S3) and compatible Storage Services. See the <a href="https://github.com/docker/docker.github.io/tree/master/registry/storage-drivers/s3.md">driver’s reference documentation</a>.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">swift</code></td>
      <td>Uses Openstack Swift object storage. See the <a href="https://github.com/docker/docker.github.io/tree/master/registry/storage-drivers/swift.md">driver’s reference documentation</a>.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">oss</code></td>
      <td>Uses Aliyun OSS for object storage. See the <a href="https://github.com/docker/docker.github.io/tree/master/registry/storage-drivers/oss.md">driver’s reference documentation</a>.</td>
    </tr>
  </tbody>
</table>

<p>For testing only, you can use the <a href="https://github.com/docker/docker.github.io/tree/master/registry/storage-drivers/inmemory.md"><code class="language-plaintext highlighter-rouge">inmemory</code> storage
driver</a>.
If you would like to run a registry from volatile memory, use the
<a href="https://github.com/docker/docker.github.io/tree/master/registry/storage-drivers/filesystem.md"><code class="language-plaintext highlighter-rouge">filesystem</code> driver</a>
on a ramdisk.</p>

<p>If you are deploying a registry on Windows, a Windows volume mounted from the
host is not recommended. Instead, you can use a S3 or Azure backing
data-store. If you do use a Windows volume, the length of the <code class="language-plaintext highlighter-rouge">PATH</code> to
the mount point must be within the <code class="language-plaintext highlighter-rouge">MAX_PATH</code> limits (typically 255 characters),
or this error will occur:</p>

<pre><code class="language-none">mkdir /XXX protocol error and your registry will not function properly.
</code></pre>

<h3 id="maintenance"><code class="language-plaintext highlighter-rouge">maintenance</code></h3>

<p>Currently, upload purging and read-only mode are the only <code class="language-plaintext highlighter-rouge">maintenance</code>
functions available.</p>

<h3 id="uploadpurging"><code class="language-plaintext highlighter-rouge">uploadpurging</code></h3>

<p>Upload purging is a background process that periodically removes orphaned files
from the upload directories of the registry. Upload purging is enabled by
default. To configure upload directory purging, the following parameters must
be set.</p>

<table>
  <thead>
    <tr>
      <th>Parameter</th>
      <th>Required</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">enabled</code></td>
      <td>yes</td>
      <td>Set to <code class="language-plaintext highlighter-rouge">true</code> to enable upload purging. Defaults to <code class="language-plaintext highlighter-rouge">true</code>.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">age</code></td>
      <td>yes</td>
      <td>Upload directories which are older than this age will be deleted.Defaults to <code class="language-plaintext highlighter-rouge">168h</code> (1 week).</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">interval</code></td>
      <td>yes</td>
      <td>The interval between upload directory purging. Defaults to <code class="language-plaintext highlighter-rouge">24h</code>.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">dryrun</code></td>
      <td>yes</td>
      <td>Set <code class="language-plaintext highlighter-rouge">dryrun</code> to <code class="language-plaintext highlighter-rouge">true</code> to obtain a summary of what directories will be deleted. Defaults to <code class="language-plaintext highlighter-rouge">false</code>.</td>
    </tr>
  </tbody>
</table>

<blockquote>
  <p><strong>Note</strong>: <code class="language-plaintext highlighter-rouge">age</code> and <code class="language-plaintext highlighter-rouge">interval</code> are strings containing a number with optional
fraction and a unit suffix. Some examples: <code class="language-plaintext highlighter-rouge">45m</code>, <code class="language-plaintext highlighter-rouge">2h10m</code>, <code class="language-plaintext highlighter-rouge">168h</code>.</p>
</blockquote>

<h3 id="readonly"><code class="language-plaintext highlighter-rouge">readonly</code></h3>

<p>If the <code class="language-plaintext highlighter-rouge">readonly</code> section under <code class="language-plaintext highlighter-rouge">maintenance</code> has <code class="language-plaintext highlighter-rouge">enabled</code> set to <code class="language-plaintext highlighter-rouge">true</code>,
clients will not be allowed to write to the registry. This mode is useful to
temporarily prevent writes to the backend storage so a garbage collection pass
can be run.  Before running garbage collection, the registry should be
restarted with readonly’s <code class="language-plaintext highlighter-rouge">enabled</code> set to true. After the garbage collection
pass finishes, the registry may be restarted again, this time with <code class="language-plaintext highlighter-rouge">readonly</code>
removed from the configuration (or set to false).</p>

<h3 id="delete"><code class="language-plaintext highlighter-rouge">delete</code></h3>

<p>Use the <code class="language-plaintext highlighter-rouge">delete</code> structure to enable the deletion of image blobs and manifests
by digest. It defaults to false, but it can be enabled by writing the following
on the configuration file:</p>

<pre><code class="language-none">delete:
  enabled: true
</code></pre>

<h3 id="cache"><code class="language-plaintext highlighter-rouge">cache</code></h3>

<p>Use the <code class="language-plaintext highlighter-rouge">cache</code> structure to enable caching of data accessed in the storage
backend. Currently, the only available cache provides fast access to layer
metadata, which uses the <code class="language-plaintext highlighter-rouge">blobdescriptor</code> field if configured.</p>

<p>You can set <code class="language-plaintext highlighter-rouge">blobdescriptor</code> field to <code class="language-plaintext highlighter-rouge">redis</code> or <code class="language-plaintext highlighter-rouge">inmemory</code>. If set to <code class="language-plaintext highlighter-rouge">redis</code>,a
Redis pool caches layer metadata. If set to <code class="language-plaintext highlighter-rouge">inmemory</code>, an in-memory map caches
layer metadata.</p>

<blockquote>
  <p><strong>NOTE</strong>: Formerly, <code class="language-plaintext highlighter-rouge">blobdescriptor</code> was known as <code class="language-plaintext highlighter-rouge">layerinfo</code>. While these
are equivalent, <code class="language-plaintext highlighter-rouge">layerinfo</code> has been deprecated.</p>
</blockquote>

<h3 id="redirect"><code class="language-plaintext highlighter-rouge">redirect</code></h3>

<p>The <code class="language-plaintext highlighter-rouge">redirect</code> subsection provides configuration for managing redirects from
content backends. For backends that support it, redirecting is enabled by
default. In certain deployment scenarios, you may decide to route all data
through the Registry, rather than redirecting to the backend. This may be more
efficient when using a backend that is not co-located or when a registry
instance is aggressively caching.</p>

<p>To disable redirects, add a single flag <code class="language-plaintext highlighter-rouge">disable</code>, set to <code class="language-plaintext highlighter-rouge">true</code>
under the <code class="language-plaintext highlighter-rouge">redirect</code> section:</p>

<pre><code class="language-none">redirect:
  disable: true
</code></pre>

<h2 id="auth"><code class="language-plaintext highlighter-rouge">auth</code></h2>

<pre><code class="language-none">auth:
  silly:
    realm: silly-realm
    service: silly-service
  token:
    realm: token-realm
    service: token-service
    issuer: registry-token-issuer
    rootcertbundle: /root/certs/bundle
  htpasswd:
    realm: basic-realm
    path: /path/to/htpasswd
</code></pre>

<p>The <code class="language-plaintext highlighter-rouge">auth</code> option is <strong>optional</strong>. Possible auth providers include:</p>

<ul>
  <li><a href="#silly"><code class="language-plaintext highlighter-rouge">silly</code></a></li>
  <li><a href="#token"><code class="language-plaintext highlighter-rouge">token</code></a></li>
  <li><a href="#htpasswd"><code class="language-plaintext highlighter-rouge">htpasswd</code></a></li>
  <li>[<code class="language-plaintext highlighter-rouge">none</code>]</li>
</ul>

<p>You can configure only one authentication provider.</p>

<h3 id="silly"><code class="language-plaintext highlighter-rouge">silly</code></h3>

<p>The <code class="language-plaintext highlighter-rouge">silly</code> authentication provider is only appropriate for development. It simply checks
for the existence of the <code class="language-plaintext highlighter-rouge">Authorization</code> header in the HTTP request. It does not
check the header’s value. If the header does not exist, the <code class="language-plaintext highlighter-rouge">silly</code> auth
responds with a challenge response, echoing back the realm, service, and scope
for which access was denied.</p>

<p>The following values are used to configure the response:</p>

<table>
  <thead>
    <tr>
      <th>Parameter</th>
      <th>Required</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">realm</code></td>
      <td>yes</td>
      <td>The realm in which the registry server authenticates.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">service</code></td>
      <td>yes</td>
      <td>The service being authenticated.</td>
    </tr>
  </tbody>
</table>

<h3 id="token"><code class="language-plaintext highlighter-rouge">token</code></h3>

<p>Token-based authentication allows you to decouple the authentication system from
the registry. It is an established authentication paradigm with a high degree of
security.</p>

<table>
  <thead>
    <tr>
      <th>Parameter</th>
      <th>Required</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">realm</code></td>
      <td>yes</td>
      <td>The realm in which the registry server authenticates.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">service</code></td>
      <td>yes</td>
      <td>The service being authenticated.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">issuer</code></td>
      <td>yes</td>
      <td>The name of the token issuer. The issuer inserts this into the token so it must match the value configured for the issuer.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">rootcertbundle</code></td>
      <td>yes</td>
      <td>The absolute path to the root certificate bundle. This bundle contains the public part of the certificates used to sign authentication tokens.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">autoredirect</code></td>
      <td>no</td>
      <td>When set to <code class="language-plaintext highlighter-rouge">true</code>, <code class="language-plaintext highlighter-rouge">realm</code> will automatically be set using the Host header of the request as the domain and a path of <code class="language-plaintext highlighter-rouge">/auth/token/</code></td>
    </tr>
  </tbody>
</table>

<p>For more information about Token based authentication configuration, see the
<a href="/registry/spec/auth/token/">specification</a>.</p>

<h3 id="htpasswd"><code class="language-plaintext highlighter-rouge">htpasswd</code></h3>

<p>The <em>htpasswd</em> authentication backed allows you to configure basic
authentication using an
<a href="https://httpd.apache.org/docs/2.4/programs/htpasswd.html">Apache htpasswd file</a>.
The only supported password format is
<a href="http://en.wikipedia.org/wiki/Bcrypt"><code class="language-plaintext highlighter-rouge">bcrypt</code></a>. Entries with other hash types
are ignored. The <code class="language-plaintext highlighter-rouge">htpasswd</code> file is loaded once, at startup. If the file is
invalid, the registry will display an error and will not start.</p>

<blockquote>
  <p><strong>Warning</strong>: If the <code class="language-plaintext highlighter-rouge">htpasswd</code> file is missing, the file will be created and provisioned with a default user and automatically generated password.
The password will be printed to stdout.</p>
</blockquote>

<blockquote>
  <p><strong>Warning</strong>: Only use the <code class="language-plaintext highlighter-rouge">htpasswd</code> authentication scheme with TLS
configured, since basic authentication sends passwords as part of the HTTP
header.</p>
</blockquote>

<table>
  <thead>
    <tr>
      <th>Parameter</th>
      <th>Required</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">realm</code></td>
      <td>yes</td>
      <td>The realm in which the registry server authenticates.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">path</code></td>
      <td>yes</td>
      <td>The path to the <code class="language-plaintext highlighter-rouge">htpasswd</code> file to load at startup.</td>
    </tr>
  </tbody>
</table>

<h2 id="middleware"><code class="language-plaintext highlighter-rouge">middleware</code></h2>

<p>The <code class="language-plaintext highlighter-rouge">middleware</code> structure is <strong>optional</strong>. Use this option to inject middleware at
named hook points. Each middleware must implement the same interface as the
object it is wrapping. For instance, a registry middleware must implement the
<code class="language-plaintext highlighter-rouge">distribution.Namespace</code> interface, while a repository middleware must implement
<code class="language-plaintext highlighter-rouge">distribution.Repository</code>, and a storage middleware must implement
<code class="language-plaintext highlighter-rouge">driver.StorageDriver</code>.</p>

<p>This is an example configuration of the <code class="language-plaintext highlighter-rouge">cloudfront</code>  middleware, a storage
middleware:</p>

<pre><code class="language-none">middleware:
  registry:
    - name: ARegistryMiddleware
      options:
        foo: bar
  repository:
    - name: ARepositoryMiddleware
      options:
        foo: bar
  storage:
    - name: cloudfront
      options:
        baseurl: https://my.cloudfronted.domain.com/
        privatekey: /path/to/pem
        keypairid: cloudfrontkeypairid
        duration: 3000s
        ipfilteredby: awsregion
        awsregion: us-east-1, use-east-2
        updatefrenquency: 12h
        iprangesurl: https://ip-ranges.amazonaws.com/ip-ranges.json
</code></pre>

<p>Each middleware entry has <code class="language-plaintext highlighter-rouge">name</code> and <code class="language-plaintext highlighter-rouge">options</code> entries. The <code class="language-plaintext highlighter-rouge">name</code> must
correspond to the name under which the middleware registers itself. The
<code class="language-plaintext highlighter-rouge">options</code> field is a map that details custom configuration required to
initialize the middleware. It is treated as a <code class="language-plaintext highlighter-rouge">map[string]interface{}</code>. As such,
it supports any interesting structures desired, leaving it up to the middleware
initialization function to best determine how to handle the specific
interpretation of the options.</p>

<h3 id="cloudfront"><code class="language-plaintext highlighter-rouge">cloudfront</code></h3>

<table>
  <thead>
    <tr>
      <th>Parameter</th>
      <th>Required</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">baseurl</code></td>
      <td>yes</td>
      <td>The <code class="language-plaintext highlighter-rouge">SCHEME://HOST[/PATH]</code> at which Cloudfront is served.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">privatekey</code></td>
      <td>yes</td>
      <td>The private key for Cloudfront, provided by AWS.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">keypairid</code></td>
      <td>yes</td>
      <td>The key pair ID provided by AWS.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">duration</code></td>
      <td>no</td>
      <td>An integer and unit for the duration of the Cloudfront session. Valid time units are <code class="language-plaintext highlighter-rouge">ns</code>, <code class="language-plaintext highlighter-rouge">us</code> (or <code class="language-plaintext highlighter-rouge">µs</code>), <code class="language-plaintext highlighter-rouge">ms</code>, <code class="language-plaintext highlighter-rouge">s</code>, <code class="language-plaintext highlighter-rouge">m</code>, or <code class="language-plaintext highlighter-rouge">h</code>. For example, <code class="language-plaintext highlighter-rouge">3000s</code> is valid, but <code class="language-plaintext highlighter-rouge">3000 s</code> is not. If you do not specify a <code class="language-plaintext highlighter-rouge">duration</code> or you specify an integer without a time unit, the duration defaults to <code class="language-plaintext highlighter-rouge">20m</code> (20 minutes).</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">ipfilteredby</code></td>
      <td>no</td>
      <td>A string with the following value <code class="language-plaintext highlighter-rouge">none</code>, <code class="language-plaintext highlighter-rouge">aws</code> or <code class="language-plaintext highlighter-rouge">awsregion</code>.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">awsregion</code></td>
      <td>no</td>
      <td>A comma separated string of AWS regions, only available when <code class="language-plaintext highlighter-rouge">ipfilteredby</code> is <code class="language-plaintext highlighter-rouge">awsregion</code>. For example, <code class="language-plaintext highlighter-rouge">us-east-1, us-west-2</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">updatefrenquency</code></td>
      <td>no</td>
      <td>The frequency to update AWS IP regions, default: <code class="language-plaintext highlighter-rouge">12h</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">iprangesurl</code></td>
      <td>no</td>
      <td>The URL contains the AWS IP ranges information, default: <code class="language-plaintext highlighter-rouge">https://ip-ranges.amazonaws.com/ip-ranges.json</code></td>
    </tr>
  </tbody>
</table>

<p>Value of <code class="language-plaintext highlighter-rouge">ipfilteredby</code> can be:</p>

<table>
  <thead>
    <tr>
      <th>Value</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">none</code></td>
      <td>default, do not filter by IP</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">aws</code></td>
      <td>IP from AWS goes to S3 directly</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">awsregion</code></td>
      <td>IP from certain AWS regions goes to S3 directly, use together with <code class="language-plaintext highlighter-rouge">awsregion</code>.</td>
    </tr>
  </tbody>
</table>

<h3 id="redirect-1"><code class="language-plaintext highlighter-rouge">redirect</code></h3>

<p>You can use the <code class="language-plaintext highlighter-rouge">redirect</code> storage middleware to specify a custom URL to a
location of a proxy for the layer stored by the S3 storage driver.</p>

<table>
  <thead>
    <tr>
      <th>Parameter</th>
      <th>Required</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">baseurl</code></td>
      <td>yes</td>
      <td><code class="language-plaintext highlighter-rouge">SCHEME://HOST</code> at which layers are served. Can also contain port. For example, <code class="language-plaintext highlighter-rouge">https://example.com:5443</code>.</td>
    </tr>
  </tbody>
</table>

<h2 id="reporting"><code class="language-plaintext highlighter-rouge">reporting</code></h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>reporting:
  bugsnag:
    apikey: bugsnagapikey
    releasestage: bugsnagreleasestage
    endpoint: bugsnagendpoint
  newrelic:
    licensekey: newreliclicensekey
    name: newrelicname
    verbose: true
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">reporting</code> option is <strong>optional</strong> and configures error and metrics
reporting tools. At the moment only two services are supported:</p>

<ul>
  <li><a href="#bugsnag">Bugsnag</a></li>
  <li><a href="#new-relic">New Relic</a></li>
</ul>

<p>A valid configuration may contain both.</p>

<h3 id="bugsnag"><code class="language-plaintext highlighter-rouge">bugsnag</code></h3>

<table>
  <thead>
    <tr>
      <th>Parameter</th>
      <th>Required</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">apikey</code></td>
      <td>yes</td>
      <td>The API Key provided by Bugsnag.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">releasestage</code></td>
      <td>no</td>
      <td>Tracks where the registry is deployed, using a string like <code class="language-plaintext highlighter-rouge">production</code>, <code class="language-plaintext highlighter-rouge">staging</code>, or <code class="language-plaintext highlighter-rouge">development</code>.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">endpoint</code></td>
      <td>no</td>
      <td>The enterprise Bugsnag endpoint.</td>
    </tr>
  </tbody>
</table>

<h3 id="newrelic"><code class="language-plaintext highlighter-rouge">newrelic</code></h3>

<table>
  <thead>
    <tr>
      <th>Parameter</th>
      <th>Required</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">licensekey</code></td>
      <td>yes</td>
      <td>License key provided by New Relic.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">name</code></td>
      <td>no</td>
      <td>New Relic application name.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">verbose</code></td>
      <td>no</td>
      <td>Set to <code class="language-plaintext highlighter-rouge">true</code> to enable New Relic debugging output on <code class="language-plaintext highlighter-rouge">stdout</code>.</td>
    </tr>
  </tbody>
</table>

<h2 id="http"><code class="language-plaintext highlighter-rouge">http</code></h2>

<pre><code class="language-none">http:
  addr: localhost:5000
  net: tcp
  prefix: /my/nested/registry/
  host: https://myregistryaddress.org:5000
  secret: asecretforlocaldevelopment
  relativeurls: false
  draintimeout: 60s
  tls:
    certificate: /path/to/x509/public
    key: /path/to/x509/private
    clientcas:
      - /path/to/ca.pem
      - /path/to/another/ca.pem
    minimumtls: tls1.2
    ciphersuites:
      - TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384
      - TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384
    letsencrypt:
      cachefile: /path/to/cache-file
      email: emailused@letsencrypt.com
      hosts: [myregistryaddress.org]
  debug:
    addr: localhost:5001
  headers:
    X-Content-Type-Options: [nosniff]
  http2:
    disabled: false
</code></pre>

<p>The <code class="language-plaintext highlighter-rouge">http</code> option details the configuration for the HTTP server that hosts the
registry.</p>

<table>
  <thead>
    <tr>
      <th>Parameter</th>
      <th>Required</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">addr</code></td>
      <td>yes</td>
      <td>The address for which the server should accept connections. The form depends on a network type (see the <code class="language-plaintext highlighter-rouge">net</code> option). Use <code class="language-plaintext highlighter-rouge">HOST:PORT</code> for TCP and <code class="language-plaintext highlighter-rouge">FILE</code> for a UNIX socket.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">net</code></td>
      <td>no</td>
      <td>The network used to create a listening socket. Known networks are <code class="language-plaintext highlighter-rouge">unix</code> and <code class="language-plaintext highlighter-rouge">tcp</code>.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">prefix</code></td>
      <td>no</td>
      <td>If the server does not run at the root path, set this to the value of the prefix. The root path is the section before <code class="language-plaintext highlighter-rouge">v2</code>. It requires both preceding and trailing slashes, such as in the example <code class="language-plaintext highlighter-rouge">/path/</code>.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">host</code></td>
      <td>no</td>
      <td>A fully-qualified URL for an externally-reachable address for the registry. If present, it is used when creating generated URLs. Otherwise, these URLs are derived from client requests.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">secret</code></td>
      <td>no</td>
      <td>A random piece of data used to sign state that may be stored with the client to protect against tampering. For production environments you should generate a random piece of data using a cryptographically secure random generator. If you omit the secret, the registry will automatically generate a secret when it starts. <strong>If you are building a cluster of registries behind a load balancer, you MUST ensure the secret is the same for all registries.</strong></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">relativeurls</code></td>
      <td>no</td>
      <td>If <code class="language-plaintext highlighter-rouge">true</code>,  the registry returns relative URLs in Location headers. The client is responsible for resolving the correct URL. <strong>This option is not compatible with Docker 1.7 and earlier.</strong></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">draintimeout</code></td>
      <td>no</td>
      <td>Amount of time to wait for HTTP connections to drain before shutting down after registry receives SIGTERM signal</td>
    </tr>
  </tbody>
</table>

<h3 id="tls"><code class="language-plaintext highlighter-rouge">tls</code></h3>

<p>The <code class="language-plaintext highlighter-rouge">tls</code> structure within <code class="language-plaintext highlighter-rouge">http</code> is <strong>optional</strong>. Use this to configure TLS
for the server. If you already have a web server running on
the same host as the registry, you may prefer to configure TLS on that web server
and proxy connections to the registry server.</p>

<table>
  <thead>
    <tr>
      <th>Parameter</th>
      <th>Required</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">certificate</code></td>
      <td>yes</td>
      <td>Absolute path to the x509 certificate file.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">key</code></td>
      <td>yes</td>
      <td>Absolute path to the x509 private key file.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">clientcas</code></td>
      <td>no</td>
      <td>An array of absolute paths to x509 CA files.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">minimumtls</code></td>
      <td>no</td>
      <td>Minimum TLS version allowed (tls1.0, tls1.1, tls1.2, tls1.3). Defaults to tls1.2</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">ciphersuites</code></td>
      <td>no</td>
      <td>Cipher suites allowed. Please see below for allowed values and default.</td>
    </tr>
  </tbody>
</table>

<p>Available cipher suites:</p>
<ul>
  <li>TLS_RSA_WITH_RC4_128_SHA</li>
  <li>TLS_RSA_WITH_3DES_EDE_CBC_SHA</li>
  <li>TLS_RSA_WITH_AES_128_CBC_SHA</li>
  <li>TLS_RSA_WITH_AES_256_CBC_SHA</li>
  <li>TLS_RSA_WITH_AES_128_CBC_SHA256</li>
  <li>TLS_RSA_WITH_AES_128_GCM_SHA256</li>
  <li>TLS_RSA_WITH_AES_256_GCM_SHA384</li>
  <li>TLS_ECDHE_ECDSA_WITH_RC4_128_SHA</li>
  <li>TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA</li>
  <li>TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA</li>
  <li>TLS_ECDHE_RSA_WITH_RC4_128_SHA</li>
  <li>TLS_ECDHE_RSA_WITH_3DES_EDE_CBC_SHA</li>
  <li>TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA</li>
  <li>TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA</li>
  <li>TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256</li>
  <li>TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256</li>
  <li>TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256</li>
  <li>TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256</li>
  <li>TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384</li>
  <li>TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384</li>
  <li>TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_SHA256</li>
  <li>TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305_SHA256</li>
  <li>TLS_AES_128_GCM_SHA256</li>
  <li>TLS_AES_256_GCM_SHA384</li>
  <li>TLS_CHACHA20_POLY1305_SHA256</li>
</ul>

<p>Default cipher suites:</p>
<ul>
  <li>TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384</li>
  <li>TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384</li>
  <li>TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305_SHA256</li>
  <li>TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_SHA256</li>
  <li>TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256</li>
  <li>TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256</li>
  <li>TLS_AES_128_GCM_SHA256</li>
  <li>TLS_CHACHA20_POLY1305_SHA256</li>
  <li>TLS_AES_256_GCM_SHA384</li>
</ul>

<h3 id="letsencrypt"><code class="language-plaintext highlighter-rouge">letsencrypt</code></h3>

<p>The <code class="language-plaintext highlighter-rouge">letsencrypt</code> structure within <code class="language-plaintext highlighter-rouge">tls</code> is <strong>optional</strong>. Use this to configure
TLS certificates provided by
<a href="https://letsencrypt.org/how-it-works/">Let’s Encrypt</a>.</p>

<blockquote>
  <p><strong>NOTE</strong>: When using Let’s Encrypt, ensure that the outward-facing address is
accessible on port <code class="language-plaintext highlighter-rouge">443</code>. The registry defaults to listening on port <code class="language-plaintext highlighter-rouge">5000</code>.
If you run the registry as a container, consider adding the flag <code class="language-plaintext highlighter-rouge">-p 443:5000</code>
to the <code class="language-plaintext highlighter-rouge">docker run</code> command or using a similar setting in a cloud
configuration. You should also set the <code class="language-plaintext highlighter-rouge">hosts</code> option to the list of hostnames
that are valid for this registry to avoid trying to get certificates for random
hostnames due to malicious clients connecting with bogus SNI hostnames.</p>
</blockquote>

<table>
  <thead>
    <tr>
      <th>Parameter</th>
      <th>Required</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">cachefile</code></td>
      <td>yes</td>
      <td>Absolute path to a file where the Let’s Encrypt agent can cache data.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">email</code></td>
      <td>yes</td>
      <td>The email address used to register with Let’s Encrypt.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">hosts</code></td>
      <td>no</td>
      <td>The hostnames allowed for Let’s Encrypt certificates.</td>
    </tr>
  </tbody>
</table>

<h3 id="debug"><code class="language-plaintext highlighter-rouge">debug</code></h3>

<p>The <code class="language-plaintext highlighter-rouge">debug</code> option is <strong>optional</strong> . Use it to configure a debug server that
can be helpful in diagnosing problems. The debug endpoint can be used for
monitoring registry metrics and health, as well as profiling. Sensitive
information may be available via the debug endpoint. Please be certain that
access to the debug endpoint is locked down in a production environment.</p>

<p>The <code class="language-plaintext highlighter-rouge">debug</code> section takes a single required <code class="language-plaintext highlighter-rouge">addr</code> parameter, which specifies
the <code class="language-plaintext highlighter-rouge">HOST:PORT</code> on which the debug server should accept connections.</p>

<h2 id="prometheus"><code class="language-plaintext highlighter-rouge">prometheus</code></h2>

<p>The <code class="language-plaintext highlighter-rouge">prometheus</code> option defines whether the prometheus metrics is enable, as well
as the path to access the metrics.</p>

<table>
  <thead>
    <tr>
      <th>Parameter</th>
      <th>Required</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">enabled</code></td>
      <td>no</td>
      <td>Set <code class="language-plaintext highlighter-rouge">true</code> to enable the prometheus server</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">path</code></td>
      <td>no</td>
      <td>The path to access the metrics, <code class="language-plaintext highlighter-rouge">/metrics</code> by default</td>
    </tr>
  </tbody>
</table>

<p>The url to access the metrics is <code class="language-plaintext highlighter-rouge">HOST:PORT/path</code>, where <code class="language-plaintext highlighter-rouge">HOST:PORT</code> is defined
in <code class="language-plaintext highlighter-rouge">addr</code> under <code class="language-plaintext highlighter-rouge">debug</code>.</p>

<h3 id="headers"><code class="language-plaintext highlighter-rouge">headers</code></h3>

<p>The <code class="language-plaintext highlighter-rouge">headers</code> option is <strong>optional</strong> . Use it to specify headers that the HTTP
server should include in responses. This can be used for security headers such
as <code class="language-plaintext highlighter-rouge">Strict-Transport-Security</code>.</p>

<p>The <code class="language-plaintext highlighter-rouge">headers</code> option should contain an option for each header to include, where
the parameter name is the header’s name, and the parameter value a list of the
header’s payload values.</p>

<p>Including <code class="language-plaintext highlighter-rouge">X-Content-Type-Options: [nosniff]</code> is recommended, so that browsers
will not interpret content as HTML if they are directed to load a page from the
registry. This header is included in the example configuration file.</p>

<h3 id="http2"><code class="language-plaintext highlighter-rouge">http2</code></h3>

<p>The <code class="language-plaintext highlighter-rouge">http2</code> structure within <code class="language-plaintext highlighter-rouge">http</code> is <strong>optional</strong>. Use this to control http2
settings for the registry.</p>

<table>
  <thead>
    <tr>
      <th>Parameter</th>
      <th>Required</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">disabled</code></td>
      <td>no</td>
      <td>If <code class="language-plaintext highlighter-rouge">true</code>, then <code class="language-plaintext highlighter-rouge">http2</code> support is disabled.</td>
    </tr>
  </tbody>
</table>

<h2 id="notifications"><code class="language-plaintext highlighter-rouge">notifications</code></h2>

<pre><code class="language-none">notifications:
  events:
    includereferences: true
  endpoints:
    - name: alistener
      disabled: false
      url: https://my.listener.com/event
      headers: &lt;http.Header&gt;
      timeout: 1s
      threshold: 10
      backoff: 1s
      ignoredmediatypes:
        - application/octet-stream
      ignore:
        mediatypes:
           - application/octet-stream
        actions:
           - pull
</code></pre>

<p>The notifications option is <strong>optional</strong> and currently may contain a single
option, <code class="language-plaintext highlighter-rouge">endpoints</code>.</p>

<h3 id="endpoints"><code class="language-plaintext highlighter-rouge">endpoints</code></h3>

<p>The <code class="language-plaintext highlighter-rouge">endpoints</code> structure contains a list of named services (URLs) that can
accept event notifications.</p>

<table>
  <thead>
    <tr>
      <th>Parameter</th>
      <th>Required</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">name</code></td>
      <td>yes</td>
      <td>A human-readable name for the service.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">disabled</code></td>
      <td>no</td>
      <td>If <code class="language-plaintext highlighter-rouge">true</code>, notifications are disabled for the service.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">url</code></td>
      <td>yes</td>
      <td>The URL to which events should be published.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">headers</code></td>
      <td>yes</td>
      <td>A list of static headers to add to each request. Each header’s name is a key beneath <code class="language-plaintext highlighter-rouge">headers</code>, and each value is a list of payloads for that header name. Values must always be lists.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">timeout</code></td>
      <td>yes</td>
      <td>A value for the HTTP timeout. A positive integer and an optional suffix indicating the unit of time, which may be <code class="language-plaintext highlighter-rouge">ns</code>, <code class="language-plaintext highlighter-rouge">us</code>, <code class="language-plaintext highlighter-rouge">ms</code>, <code class="language-plaintext highlighter-rouge">s</code>, <code class="language-plaintext highlighter-rouge">m</code>, or <code class="language-plaintext highlighter-rouge">h</code>. If you omit the unit of time, <code class="language-plaintext highlighter-rouge">ns</code> is used.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">threshold</code></td>
      <td>yes</td>
      <td>An integer specifying how long to wait before backing off a failure.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">backoff</code></td>
      <td>yes</td>
      <td>How long the system backs off before retrying after a failure. A positive integer and an optional suffix indicating the unit of time, which may be <code class="language-plaintext highlighter-rouge">ns</code>, <code class="language-plaintext highlighter-rouge">us</code>, <code class="language-plaintext highlighter-rouge">ms</code>, <code class="language-plaintext highlighter-rouge">s</code>, <code class="language-plaintext highlighter-rouge">m</code>, or <code class="language-plaintext highlighter-rouge">h</code>. If you omit the unit of time, <code class="language-plaintext highlighter-rouge">ns</code> is used.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">ignoredmediatypes</code></td>
      <td>no</td>
      <td>A list of target media types to ignore. Events with these target media types are not published to the endpoint.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">ignore</code></td>
      <td>no</td>
      <td>Events with these mediatypes or actions are not published to the endpoint.</td>
    </tr>
  </tbody>
</table>

<h4 id="ignore"><code class="language-plaintext highlighter-rouge">ignore</code></h4>
<p>| Parameter | Required | Description                                           |
|-----------|----------|-------------------------------------------------------|
| <code class="language-plaintext highlighter-rouge">mediatypes</code>|no| A list of target media types to ignore. Events with these target media types are not published to the endpoint. |
| <code class="language-plaintext highlighter-rouge">actions</code>   |no| A list of actions to ignore. Events with these actions are not published to the endpoint. |</p>

<h3 id="events"><code class="language-plaintext highlighter-rouge">events</code></h3>

<p>The <code class="language-plaintext highlighter-rouge">events</code> structure configures the information provided in event notifications.</p>

<table>
  <thead>
    <tr>
      <th>Parameter</th>
      <th>Required</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">includereferences</code></td>
      <td>no</td>
      <td>If <code class="language-plaintext highlighter-rouge">true</code>, include reference information in manifest events.</td>
    </tr>
  </tbody>
</table>

<h2 id="redis"><code class="language-plaintext highlighter-rouge">redis</code></h2>

<pre><code class="language-none">redis:
  addr: localhost:6379
  password: asecret
  db: 0
  dialtimeout: 10ms
  readtimeout: 10ms
  writetimeout: 10ms
  pool:
    maxidle: 16
    maxactive: 64
    idletimeout: 300s
</code></pre>

<p>Declare parameters for constructing the <code class="language-plaintext highlighter-rouge">redis</code> connections. Registry instances
may use the Redis instance for several applications. Currently, it caches
information about immutable blobs. Most of the <code class="language-plaintext highlighter-rouge">redis</code> options control
how the registry connects to the <code class="language-plaintext highlighter-rouge">redis</code> instance. You can control the pool’s
behavior with the <a href="#pool">pool</a> subsection.</p>

<p>You should configure Redis with the <strong>allkeys-lru</strong> eviction policy, because the
registry does not set an expiration value on keys.</p>

<table>
  <thead>
    <tr>
      <th>Parameter</th>
      <th>Required</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">addr</code></td>
      <td>yes</td>
      <td>The address (host and port) of the Redis instance.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">password</code></td>
      <td>no</td>
      <td>A password used to authenticate to the Redis instance.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">db</code></td>
      <td>no</td>
      <td>The name of the database to use for each connection.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">dialtimeout</code></td>
      <td>no</td>
      <td>The timeout for connecting to the Redis instance.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">readtimeout</code></td>
      <td>no</td>
      <td>The timeout for reading from the Redis instance.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">writetimeout</code></td>
      <td>no</td>
      <td>The timeout for writing to the Redis instance.</td>
    </tr>
  </tbody>
</table>

<h3 id="pool"><code class="language-plaintext highlighter-rouge">pool</code></h3>

<pre><code class="language-none">pool:
  maxidle: 16
  maxactive: 64
  idletimeout: 300s
</code></pre>

<p>Use these settings to configure the behavior of the Redis connection pool.</p>

<table>
  <thead>
    <tr>
      <th>Parameter</th>
      <th>Required</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">maxidle</code></td>
      <td>no</td>
      <td>The maximum number of idle connections in the pool.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">maxactive</code></td>
      <td>no</td>
      <td>The maximum number of connections which can be open before blocking a connection request.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">idletimeout</code></td>
      <td>no</td>
      <td>How long to wait before closing inactive connections.</td>
    </tr>
  </tbody>
</table>

<h2 id="health"><code class="language-plaintext highlighter-rouge">health</code></h2>

<pre><code class="language-none">health:
  storagedriver:
    enabled: true
    interval: 10s
    threshold: 3
  file:
    - file: /path/to/checked/file
      interval: 10s
  http:
    - uri: http://server.to.check/must/return/200
      headers:
        Authorization: [Basic QWxhZGRpbjpvcGVuIHNlc2FtZQ==]
      statuscode: 200
      timeout: 3s
      interval: 10s
      threshold: 3
  tcp:
    - addr: redis-server.domain.com:6379
      timeout: 3s
      interval: 10s
      threshold: 3
</code></pre>

<p>The health option is <strong>optional</strong>, and contains preferences for a periodic
health check on the storage driver’s backend storage, as well as optional
periodic checks on local files, HTTP URIs, and/or TCP servers. The results of
the health checks are available at the <code class="language-plaintext highlighter-rouge">/debug/health</code> endpoint on the debug
HTTP server if the debug HTTP server is enabled (see http section).</p>

<h3 id="storagedriver"><code class="language-plaintext highlighter-rouge">storagedriver</code></h3>

<p>The <code class="language-plaintext highlighter-rouge">storagedriver</code> structure contains options for a health check on the
configured storage driver’s backend storage. The health check is only active
when <code class="language-plaintext highlighter-rouge">enabled</code> is set to <code class="language-plaintext highlighter-rouge">true</code>.</p>

<table>
  <thead>
    <tr>
      <th>Parameter</th>
      <th>Required</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">enabled</code></td>
      <td>yes</td>
      <td>Set to <code class="language-plaintext highlighter-rouge">true</code> to enable storage driver health checks or <code class="language-plaintext highlighter-rouge">false</code> to disable them.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">interval</code></td>
      <td>no</td>
      <td>How long to wait between repetitions of the storage driver health check. A positive integer and an optional suffix indicating the unit of time. The suffix is one of <code class="language-plaintext highlighter-rouge">ns</code>, <code class="language-plaintext highlighter-rouge">us</code>, <code class="language-plaintext highlighter-rouge">ms</code>, <code class="language-plaintext highlighter-rouge">s</code>, <code class="language-plaintext highlighter-rouge">m</code>, or <code class="language-plaintext highlighter-rouge">h</code>. Defaults to <code class="language-plaintext highlighter-rouge">10s</code> if the value is omitted. If you specify a value but omit the suffix, the value is interpreted as a number of nanoseconds.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">threshold</code></td>
      <td>no</td>
      <td>A positive integer which represents the number of times the check must fail before the state is marked as unhealthy. If not specified, a single failure marks the state as unhealthy.</td>
    </tr>
  </tbody>
</table>

<h3 id="file"><code class="language-plaintext highlighter-rouge">file</code></h3>

<p>The <code class="language-plaintext highlighter-rouge">file</code> structure includes a list of paths to be periodically checked for the<br />
existence of a file. If a file exists at the given path, the health check will
fail. You can use this mechanism to bring a registry out of rotation by creating
a file.</p>

<table>
  <thead>
    <tr>
      <th>Parameter</th>
      <th>Required</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">file</code></td>
      <td>yes</td>
      <td>The path to check for existence of a file.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">interval</code></td>
      <td>no</td>
      <td>How long to wait before repeating the check. A positive integer and an optional suffix indicating the unit of time. The suffix is one of <code class="language-plaintext highlighter-rouge">ns</code>, <code class="language-plaintext highlighter-rouge">us</code>, <code class="language-plaintext highlighter-rouge">ms</code>, <code class="language-plaintext highlighter-rouge">s</code>, <code class="language-plaintext highlighter-rouge">m</code>, or <code class="language-plaintext highlighter-rouge">h</code>. Defaults to <code class="language-plaintext highlighter-rouge">10s</code> if the value is omitted. If you specify a value but omit the suffix, the value is interpreted as a number of nanoseconds.</td>
    </tr>
  </tbody>
</table>

<h3 id="http-1"><code class="language-plaintext highlighter-rouge">http</code></h3>

<p>The <code class="language-plaintext highlighter-rouge">http</code> structure includes a list of HTTP URIs to periodically check with
<code class="language-plaintext highlighter-rouge">HEAD</code> requests. If a <code class="language-plaintext highlighter-rouge">HEAD</code> request does not complete or returns an unexpected
status code, the health check will fail.</p>

<table>
  <thead>
    <tr>
      <th>Parameter</th>
      <th>Required</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">uri</code></td>
      <td>yes</td>
      <td>The URI to check.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">headers</code></td>
      <td>no</td>
      <td>Static headers to add to each request. Each header’s name is a key beneath <code class="language-plaintext highlighter-rouge">headers</code>, and each value is a list of payloads for that header name. Values must always be lists.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">statuscode</code></td>
      <td>no</td>
      <td>The expected status code from the HTTP URI. Defaults to <code class="language-plaintext highlighter-rouge">200</code>.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">timeout</code></td>
      <td>no</td>
      <td>How long to wait before timing out the HTTP request. A positive integer and an optional suffix indicating the unit of time. The suffix is one of <code class="language-plaintext highlighter-rouge">ns</code>, <code class="language-plaintext highlighter-rouge">us</code>, <code class="language-plaintext highlighter-rouge">ms</code>, <code class="language-plaintext highlighter-rouge">s</code>, <code class="language-plaintext highlighter-rouge">m</code>, or <code class="language-plaintext highlighter-rouge">h</code>. If you specify a value but omit the suffix, the value is interpreted as a number of nanoseconds.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">interval</code></td>
      <td>no</td>
      <td>How long to wait before repeating the check. A positive integer and an optional suffix indicating the unit of time. The suffix is one of <code class="language-plaintext highlighter-rouge">ns</code>, <code class="language-plaintext highlighter-rouge">us</code>, <code class="language-plaintext highlighter-rouge">ms</code>, <code class="language-plaintext highlighter-rouge">s</code>, <code class="language-plaintext highlighter-rouge">m</code>, or <code class="language-plaintext highlighter-rouge">h</code>. Defaults to <code class="language-plaintext highlighter-rouge">10s</code> if the value is omitted. If you specify a value but omit the suffix, the value is interpreted as a number of nanoseconds.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">threshold</code></td>
      <td>no</td>
      <td>The number of times the check must fail before the state is marked as unhealthy. If this field is not specified, a single failure marks the state as unhealthy.</td>
    </tr>
  </tbody>
</table>

<h3 id="tcp"><code class="language-plaintext highlighter-rouge">tcp</code></h3>

<p>The <code class="language-plaintext highlighter-rouge">tcp</code> structure includes a list of TCP addresses to periodically check using
TCP connection attempts. Addresses must include port numbers. If a connection
attempt fails, the health check will fail.</p>

<table>
  <thead>
    <tr>
      <th>Parameter</th>
      <th>Required</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">addr</code></td>
      <td>yes</td>
      <td>The TCP address and port to connect to.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">timeout</code></td>
      <td>no</td>
      <td>How long to wait before timing out the TCP connection. A positive integer and an optional suffix indicating the unit of time. The suffix is one of <code class="language-plaintext highlighter-rouge">ns</code>, <code class="language-plaintext highlighter-rouge">us</code>, <code class="language-plaintext highlighter-rouge">ms</code>, <code class="language-plaintext highlighter-rouge">s</code>, <code class="language-plaintext highlighter-rouge">m</code>, or <code class="language-plaintext highlighter-rouge">h</code>. If you specify a value but omit the suffix, the value is interpreted as a number of nanoseconds.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">interval</code></td>
      <td>no</td>
      <td>How long to wait between repetitions of the check. A positive integer and an optional suffix indicating the unit of time. The suffix is one of <code class="language-plaintext highlighter-rouge">ns</code>, <code class="language-plaintext highlighter-rouge">us</code>, <code class="language-plaintext highlighter-rouge">ms</code>, <code class="language-plaintext highlighter-rouge">s</code>, <code class="language-plaintext highlighter-rouge">m</code>, or <code class="language-plaintext highlighter-rouge">h</code>. Defaults to <code class="language-plaintext highlighter-rouge">10s</code> if the value is omitted. If you specify a value but omit the suffix, the value is interpreted as a number of nanoseconds.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">threshold</code></td>
      <td>no</td>
      <td>The number of times the check must fail before the state is marked as unhealthy. If this field is not specified, a single failure marks the state as unhealthy.</td>
    </tr>
  </tbody>
</table>

<h2 id="proxy"><code class="language-plaintext highlighter-rouge">proxy</code></h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>proxy:
  remoteurl: https://registry-1.docker.io
  username: [username]
  password: [password]
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">proxy</code> structure allows a registry to be configured as a pull-through cache
to Docker Hub.  See
<a href="https://github.com/docker/docker.github.io/tree/master/registry/recipes/mirror.md">mirror</a>
for more information. Pushing to a registry configured as a pull-through cache
is unsupported.</p>

<table>
  <thead>
    <tr>
      <th>Parameter</th>
      <th>Required</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">remoteurl</code></td>
      <td>yes</td>
      <td>The URL for the repository on Docker Hub.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">username</code></td>
      <td>no</td>
      <td>The username registered with Docker Hub which has access to the repository.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">password</code></td>
      <td>no</td>
      <td>The password used to authenticate to Docker Hub using the username specified in <code class="language-plaintext highlighter-rouge">username</code>.</td>
    </tr>
  </tbody>
</table>

<p>To enable pulling private repositories (e.g. <code class="language-plaintext highlighter-rouge">batman/robin</code>) specify the
username (such as <code class="language-plaintext highlighter-rouge">batman</code>) and the password for that username.</p>

<blockquote>
  <p><strong>Note</strong>: These private repositories are stored in the proxy cache’s storage.
Take appropriate measures to protect access to the proxy cache.</p>
</blockquote>

<h2 id="compatibility"><code class="language-plaintext highlighter-rouge">compatibility</code></h2>

<pre><code class="language-none">compatibility:
  schema1:
    signingkeyfile: /etc/registry/key.json
    enabled: true
</code></pre>

<p>Use the <code class="language-plaintext highlighter-rouge">compatibility</code> structure to configure handling of older and deprecated
features. Each subsection defines such a feature with configurable behavior.</p>

<h3 id="schema1"><code class="language-plaintext highlighter-rouge">schema1</code></h3>

<table>
  <thead>
    <tr>
      <th>Parameter</th>
      <th>Required</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">signingkeyfile</code></td>
      <td>no</td>
      <td>The signing private key used to add signatures to <code class="language-plaintext highlighter-rouge">schema1</code> manifests. If no signing key is provided, a new ECDSA key is generated when the registry starts.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">enabled</code></td>
      <td>no</td>
      <td>If this is not set to true, <code class="language-plaintext highlighter-rouge">schema1</code> manifests cannot be pushed.</td>
    </tr>
  </tbody>
</table>

<h2 id="validation"><code class="language-plaintext highlighter-rouge">validation</code></h2>

<pre><code class="language-none">validation:
  manifests:
    urls:
      allow:
        - ^https?://([^/]+\.)*example\.com/
      deny:
        - ^https?://www\.example\.com/
</code></pre>

<h3 id="disabled"><code class="language-plaintext highlighter-rouge">disabled</code></h3>

<p>The <code class="language-plaintext highlighter-rouge">disabled</code> flag disables the other options in the <code class="language-plaintext highlighter-rouge">validation</code>
section. They are enabled by default. This option deprecates the <code class="language-plaintext highlighter-rouge">enabled</code> flag.</p>

<h3 id="manifests"><code class="language-plaintext highlighter-rouge">manifests</code></h3>

<p>Use the <code class="language-plaintext highlighter-rouge">manifests</code> subsection to configure validation of manifests. If
<code class="language-plaintext highlighter-rouge">disabled</code> is <code class="language-plaintext highlighter-rouge">false</code>, the validation allows nothing.</p>

<h4 id="urls"><code class="language-plaintext highlighter-rouge">urls</code></h4>

<p>The <code class="language-plaintext highlighter-rouge">allow</code> and <code class="language-plaintext highlighter-rouge">deny</code> options are each a list of
<a href="https://godoc.org/regexp/syntax">regular expressions</a> that restrict the URLs in
pushed manifests.</p>

<p>If <code class="language-plaintext highlighter-rouge">allow</code> is unset, pushing a manifest containing URLs fails.</p>

<p>If <code class="language-plaintext highlighter-rouge">allow</code> is set, pushing a manifest succeeds only if all URLs match
one of the <code class="language-plaintext highlighter-rouge">allow</code> regular expressions <strong>and</strong> one of the following holds:</p>

<ol>
  <li><code class="language-plaintext highlighter-rouge">deny</code> is unset.</li>
  <li><code class="language-plaintext highlighter-rouge">deny</code> is set but no URLs within the manifest match any of the <code class="language-plaintext highlighter-rouge">deny</code> regular
expressions.</li>
</ol>

<h2 id="example-development-configuration">Example: Development configuration</h2>

<p>You can use this simple example for local development:</p>

<pre><code class="language-none">version: 0.1
log:
  level: debug
storage:
    filesystem:
        rootdirectory: /var/lib/registry
http:
    addr: localhost:5000
    secret: asecretforlocaldevelopment
    debug:
        addr: localhost:5001
</code></pre>

<p>This example configures the registry instance to run on port <code class="language-plaintext highlighter-rouge">5000</code>, binding to
<code class="language-plaintext highlighter-rouge">localhost</code>, with the <code class="language-plaintext highlighter-rouge">debug</code> server enabled. Registry data is stored in the
<code class="language-plaintext highlighter-rouge">/var/lib/registry</code> directory. Logging is set to <code class="language-plaintext highlighter-rouge">debug</code> mode, which is the most
verbose.</p>

<p>See
<a href="https://github.com/docker/distribution/blob/master/cmd/registry/config-example.yml">config-example.yml</a>
for another simple configuration. Both examples are generally useful for local
development.</p>

<h2 id="example-middleware-configuration">Example: Middleware configuration</h2>

<p>This example configures <a href="http://aws.amazon.com/cloudfront/">Amazon Cloudfront</a>
as the storage middleware in a registry. Middleware allows the registry to serve
layers via a content delivery network (CDN). This reduces requests to the
storage layer.</p>

<p>Cloudfront requires the S3 storage driver.</p>

<p>This is the configuration expressed in YAML:</p>

<pre><code class="language-none">middleware:
  storage:
  - name: cloudfront
    disabled: false
    options:
      baseurl: http://d111111abcdef8.cloudfront.net
      privatekey: /path/to/asecret.pem
      keypairid: asecret
      duration: 60s
</code></pre>

<p>See the configuration reference for <a href="#cloudfront">Cloudfront</a> for more
information about configuration options.</p>

<blockquote>
  <p><strong>Note</strong>: Cloudfront keys exist separately from other AWS keys.  See
<a href="http://docs.aws.amazon.com/general/latest/gr/aws-security-credentials.html">the documentation on AWS credentials</a>
for more information.</p>
</blockquote>
<span class="glyphicon glyphicon-tags" style="padding-right: 10px"></span><span style="vertical-align: 2px"><a href="/search/?q=registry">registry</a>, <a href="/search/?q=on-prem">on-prem</a>, <a href="/search/?q=images">images</a>, <a href="/search/?q=tags">tags</a>, <a href="/search/?q=repository">repository</a>, <a href="/search/?q=distribution">distribution</a>, <a href="/search/?q=configuration">configuration</a></span></section>
                    </main>
                    <nav class="col-nav">
                        <div id="sidebar-nav" class="sidebar hidden-sm hidden-xs">
                            <div id="navbar" class="nav-sidebar">
                                <ul class="nav hidden-md hidden-lg"></ul>
                                <ul class="nav" id="jsTOCLeftNav"></ul>
                            </div>
                        </div>
                    </nav>
                    <div class="col-toc">
                        <div class="sidebar hidden-xs hidden-sm">
                            <div class="toc-nav">
                                <div class="feedback-links">
                                    <ul><li><a href="https://github.com/distribution/distribution/edit/main/docs/configuration.md"><i class="fa fa-pencil-square-o" aria-hidden="true"></i> Edit this page</a></li><li><a href="https://github.com/distribution/distribution/issues/new?body=File: [docs/configuration.md](https://docs.docker.com/registry/configuration/)" class="nomunge"><i class="fa fa-check" aria-hidden="true"></i> Request docs changes</a></li><li><div class="toggle-mode">
  <div class="icon">
      <i class="fa fa-sun-o" aria-hidden="true"></i>
  </div>
  <div class="toggle-switch">
      <label class="switch">
          <input type="checkbox" id="switch-style">
          <span class="slider round"></span>
      </label>
  </div>
  <div class="icon">
      <i class="fa fa-moon-o" aria-hidden="true"></i>
  </div>
</div>
</li>
                                    </ul>
                                </div><div id="side-toc-title">On this page:</div>
<ul id="my_toc" class="inline_toc">
  <li><a href="#override-specific-configuration-options" class="nomunge">Override specific configuration options</a></li>
  <li><a href="#overriding-the-entire-configuration-file" class="nomunge">Overriding the entire configuration file</a></li>
  <li><a href="#list-of-configuration-options" class="nomunge">List of configuration options</a></li>
  <li><a href="#version" class="nomunge">version</a></li>
  <li><a href="#log" class="nomunge">log</a>
    <ul>
      <li><a href="#accesslog" class="nomunge">accesslog</a></li>
    </ul>
  </li>
  <li><a href="#hooks" class="nomunge">hooks</a></li>
  <li><a href="#loglevel" class="nomunge">loglevel</a></li>
  <li><a href="#storage" class="nomunge">storage</a>
    <ul>
      <li><a href="#maintenance" class="nomunge">maintenance</a></li>
      <li><a href="#uploadpurging" class="nomunge">uploadpurging</a></li>
      <li><a href="#readonly" class="nomunge">readonly</a></li>
      <li><a href="#delete" class="nomunge">delete</a></li>
      <li><a href="#cache" class="nomunge">cache</a></li>
      <li><a href="#redirect" class="nomunge">redirect</a></li>
    </ul>
  </li>
  <li><a href="#auth" class="nomunge">auth</a>
    <ul>
      <li><a href="#silly" class="nomunge">silly</a></li>
      <li><a href="#token" class="nomunge">token</a></li>
      <li><a href="#htpasswd" class="nomunge">htpasswd</a></li>
    </ul>
  </li>
  <li><a href="#middleware" class="nomunge">middleware</a>
    <ul>
      <li><a href="#cloudfront" class="nomunge">cloudfront</a></li>
      <li><a href="#redirect-1" class="nomunge">redirect</a></li>
    </ul>
  </li>
  <li><a href="#reporting" class="nomunge">reporting</a>
    <ul>
      <li><a href="#bugsnag" class="nomunge">bugsnag</a></li>
      <li><a href="#newrelic" class="nomunge">newrelic</a></li>
    </ul>
  </li>
  <li><a href="#http" class="nomunge">http</a>
    <ul>
      <li><a href="#tls" class="nomunge">tls</a></li>
      <li><a href="#letsencrypt" class="nomunge">letsencrypt</a></li>
      <li><a href="#debug" class="nomunge">debug</a></li>
    </ul>
  </li>
  <li><a href="#prometheus" class="nomunge">prometheus</a>
    <ul>
      <li><a href="#headers" class="nomunge">headers</a></li>
      <li><a href="#http2" class="nomunge">http2</a></li>
    </ul>
  </li>
  <li><a href="#notifications" class="nomunge">notifications</a>
    <ul>
      <li><a href="#endpoints" class="nomunge">endpoints</a>
        <ul>
          <li><a href="#ignore" class="nomunge">ignore</a></li>
        </ul>
      </li>
      <li><a href="#events" class="nomunge">events</a></li>
    </ul>
  </li>
  <li><a href="#redis" class="nomunge">redis</a>
    <ul>
      <li><a href="#pool" class="nomunge">pool</a></li>
    </ul>
  </li>
  <li><a href="#health" class="nomunge">health</a>
    <ul>
      <li><a href="#storagedriver" class="nomunge">storagedriver</a></li>
      <li><a href="#file" class="nomunge">file</a></li>
      <li><a href="#http-1" class="nomunge">http</a></li>
      <li><a href="#tcp" class="nomunge">tcp</a></li>
    </ul>
  </li>
  <li><a href="#proxy" class="nomunge">proxy</a></li>
  <li><a href="#compatibility" class="nomunge">compatibility</a>
    <ul>
      <li><a href="#schema1" class="nomunge">schema1</a></li>
    </ul>
  </li>
  <li><a href="#validation" class="nomunge">validation</a>
    <ul>
      <li><a href="#disabled" class="nomunge">disabled</a></li>
      <li><a href="#manifests" class="nomunge">manifests</a>
        <ul>
          <li><a href="#urls" class="nomunge">urls</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#example-development-configuration" class="nomunge">Example: Development configuration</a></li>
  <li><a href="#example-middleware-configuration" class="nomunge">Example: Middleware configuration</a></li>
</ul>

</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <footer class="footer">
          
    <div class="container">
        <div class="top_footer">
            <div class="row">
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><b><a href="https://www.docker.com/products" target="_blank" rel="noopener">Product offerings</a></b></li>
                        <li><a href="https://www.docker.com/products/personal" target="_blank" rel="noopener">Docker Personal</a></li>
                        <li><a href="https://www.docker.com/products/pro" target="_blank" rel="noopener">Docker Pro</a></li>
                        <li><a href="https://www.docker.com/products/team" target="_blank" rel="noopener">Docker Team</a></li>
                        <li><a href="https://www.docker.com/products/business" target="_blank" rel="noopener">Docker Business</a></li>
                        <li><a href="https://www.docker.com/products" target="_blank" rel="noopener">Compare Subscriptions</a></li>
                        <li><b><a href="https://www.docker.com/" target="_blank" rel="noopener">Features</a></b></li>
                        <li><a href="https://www.docker.com/products/docker-desktop" target="_blank" rel="noopener">Docker Desktop</a></li>
                        <li><a href="https://www.docker.com/products/docker-hub" target="_blank" rel="noopener">Docker Hub</a></li>
                        <li><a href="https://www.docker.com/products/secure-software-supply-chain" target="_blank" rel="noopener">Secure Software Supply Chain</a></li>
                        <li><a href="https://www.docker.com/products/container-runtime" target="_blank" rel="noopener">Container Runtime</a></li>
                        <li><a href="https://www.docker.com/products/developer-tools" target="_blank" rel="noopener">Developer Tools</a></li>
                        <li><a href="https://www.docker.com/partners" target="_blank" rel="noopener">Trusted Content</a></li>
                        <li><a href="https://www.docker.com/roadmap" target="_blank" rel="noopener">Docker Product Roadmap</a></li>
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><b><a href="https://www.docker.com/products/docker-desktop" target="_blank" rel="noopener">Developers</a></b></li>
                        <li><a href="https://www.docker.com/use-cases" target="_blank" rel="noopener">Use Cases</a></li>
                        <li><a href="https://docs.docker.com/get-started/" target="_blank" rel="noopener">Get Started</a></li>
                        <li><a href="https://www.docker.com/blog/" target="_blank" rel="noopener">Blog</a></li>
                        <li><a href="https://www.docker.com/docker-community" target="_blank" rel="noopener">Community</a></li>
                        <li><a href="https://www.docker.com/open-source" target="_blank" rel="noopener">Open Source</a></li>
                        <li><a href="https://www.docker.com/community/get-involved/developer-preview" target="_blank" rel="noopener">Preview Program</a></li>
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><b><a href="https://www.docker.com/products/docker-desktop" target="_blank" rel="noopener">Pricing</a></b></li>
                        <li><a href="https://www.docker.com/pricing/faq" target="_blank" rel="noopener">FAQ</a></li>
                        <li><a href="https://www.docker.com/partners/programs" target="_blank" rel="noopener">Docker Verified Publisher</a></li>
                        <li><a href="https://www.docker.com/partners" target="_blank" rel="noopener">Partners</a></li>
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><b><a href="https://www.docker.com/company" target="_blank" rel="noopener">About Us</a></b></li>
                        <li><a href="https://www.docker.com/what-container" target="_blank" rel="noopener">What is a Container?</a></li>
                        <li><a href="https://www.docker.com/why-docker" target="_blank" rel="noopener">Why Docker?</a></li>
                        <li><a href="https://www.docker.com/events" target="_blank" rel="noopener">Virtual Events</a></li>
                        <li><a href="https://www.docker.com/swag" target="_blank" rel="noopener">Swag Store
                        </a></li>
                        <li><a href="https://www.docker.com/company/newsroom" target="_blank" rel="noopener">Newsroom</a></li>
                        <li><a href="https://www.docker.com/careers" target="_blank" rel="noopener">Careers</a></li>
                        <li><a href="https://www.docker.com/company/contact" target="_blank" rel="noopener">Contact Us</a></li>
                        <li><a href="https://www.docker.com/customers" target="_blank" rel="noopener">Customers</a></li>
                        <li><a href="https://www.docker.com/newsletter-subscription" target="_blank" rel="noopener">Newsletter</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-nav">
                <nav class="footer_sub_nav">
                    <ul class="menu">
                        <li><a href="https://www.docker.com/legal/docker-terms-service" target="_blank" rel="noopener">Terms of Service</a></li>
                        <li><a href="https://status.docker.com/" target="_blank" rel="noopener">Status</a></li>
                        <li><a href="https://www.docker.com/legal" target="_blank" rel="noopener">Legal</a></li>
                    </ul>
                </nav>
            </div>
        </div>
        <div class="bottom_footer">
            <div class="footer-copyright col-xs-12 col-md-8">
                <p class="copyright">
                    Copyright &copy; 2013-2021 Docker Inc. All rights reserved. </p>
            </div>
            <div class="footer_social_nav">
                <ul class="nav-social">
                    <li class="fa fa-twitter"><a href="https://twitter.com/docker">Twitter</a></li>
                    <li class="fa fa-youtube"><a href="https://www.youtube.com/user/dockerrun">Youtube</a></li>
                    <li class="fa fa-github"><a href="https://github.com/docker">GitHub</a></li>
                    <li class="fa fa-linkedin"><a href="https://www.linkedin.com/company/docker">Linkedin</a></li>
                    <li class="fa fa-facebook"><a href="https://www.facebook.com/docker.run">Facebook</a></li>
                    <li class="fa fa-slideshare"><a href="https://www.slideshare.net/docker">Slideshare</a></li>
                    <li class="fa fa-reddit"><a href="https://www.reddit.com/r/docker">Reddit</a></li>
                </ul>
            </div>
        </div>
    </div>

    </footer>
    <script>const pageURL = "/registry/configuration/";</script></body>
</html>
